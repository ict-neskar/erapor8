import{_ as G}from"./AlertDialog-D3FX3nmh.js";import{u as I,c as J}from"./createUrl-C1_Sm4N7.js";import{d as c,a as w}from"./mixins-CKlf8GuV.js";import{$ as T}from"./api-DGas9VfV.js";import{V as A,b as P}from"./VCard-BpJLDfhD.js";import{r as i,G as L,c as k,m as o,f as l,e as r,b as g,a2 as M,o as s,am as U,t as u,v as m,y as z,d as t,F as h,h as E,aa as F}from"./main-BUumBu6a.js";import{V}from"./VAlert-CuD5NV7H.js";import{V as K}from"./VTable-BUsnUoL5.js";import{V as b}from"./VChip-BQa_6tD-.js";import"./VDialog-BEKtFyZX.js";import"./VOverlay-Bb4CDEq4.js";import"./forwardRefs-DWGaNmQL.js";import"./scopeId-CDzN2yrl.js";import"./VImg-D2Juqgex.js";import"./index-BxkgbwWS.js";import"./VAvatar-Ba-Ggnm6.js";import"./VSlideGroup-DCwY19Ye.js";const W={class:"text-center"},O={class:"text-center"},H={class:"text-center"},Q={class:"text-center"},X={class:"text-center"},ye={__name:"dapodik",setup(Y){const D=i(!0),S=i(!1),B=i([]),v=i(),f=i(!1),_=i({color:"",title:"",text:""}),$=async()=>{try{let e=(await I(J("/sinkronisasi",{query:{sekolah_id:c.sekolah_id,semester_id:w.semester_id,user_id:c.user_id}}))).data.value;S.value=e.jam_sinkron,B.value=e.data_sinkron,v.value=e.error}catch(n){console.error(n)}finally{D.value=!1}},j=n=>n.dapodik>n.erapor,y=i(!1),x=i(!1),d=i(),N=async()=>{await T(`/sinkronisasi/hitung/${c.sekolah_id}`,{method:"GET",onResponse({request:n,response:e,options:p}){let a=e._data;a.output&&(a.output.jumlah?a.output.jumlah===1&&a.output.inserted===1?d.value="Proses sinkronisasi selesai":d.value=`${a.output.table} (${a.output.inserted}/${a.output.jumlah})`:d.value=a.output.table)}})},R=async(n,e)=>{if(console.log(n),console.log(e),n&&e){x.value=!0,d.value="Menyiapkan proses sinkronisasi",y.value=!0;var p;p=setInterval(N,500),await T("/sinkronisasi/dapodik",{method:"POST",body:{email:c.email,satuan:e,tujuan:n,sekolah_id:c.sekolah_id,semester_id:w.semester_id,user_id:c.user_id},onResponse({request:a,response:C,options:Z}){C._data,y.value=!1,x.value=!1,clearInterval(p),d.value="Proses sinkronisasi selesai",f.value=!0,_.value={color:"success",title:"Berhasil",text:"Sinkronisasi Dapodik Berhasil"}}})}};L(async()=>{await $()});const q=()=>{$()};return(n,e)=>{const p=G;return s(),k("div",null,[o(D)?(s(),l(A,{key:0,class:"text-center mb-10"},{default:r(()=>[g(U,{size:60,indeterminate:"",color:"error",class:"my-10"})]),_:1})):(s(),l(A,{key:1},{default:r(()=>[o(x)?(s(),l(P,{key:0},{default:r(()=>[g(V,{color:"secondary",class:"text-center"},{default:r(()=>[u(m(o(d)),1)]),_:1})]),_:1})):z("",!0),g(P,null,{default:r(()=>[o(S)?(s(),l(V,{key:0,color:"error",class:"text-center",variant:"tonal"},{default:r(()=>e[1]||(e[1]=[t("h2",{class:"mt-4 mb-4"},"Penyesuaian Waktu Layanan Sinkronisasi Dapodik",-1),t("p",null,[u("Dikarenakan adanya proses rutin sinkronisasi data Dapodik antara Server PUSDATIN dan Server Direktorat SMK, "),t("br"),u("maka layanan sinkronisasi hanya dapat diakses antara pukul "),t("span",{class:"text-danger"},[t("b",null,"03.00 s/d 24.00 (WIB)")])],-1)])),_:1})):o(v)?(s(),l(V,{key:1,title:"Pengambilan Dapodik Gagal",type:"error",variant:"tonal"},{default:r(()=>[u(" Status Server: "+m(o(v).message),1)]),_:1})):(s(),l(K,{key:2,class:"text-no-wrap"},{default:r(()=>[e[6]||(e[6]=t("thead",null,[t("tr",null,[t("th",{class:"text-center"},"Data"),t("th",{class:"text-center"},"Jml Dapodik"),t("th",{class:"text-center"},"Jml e-Rapor"),t("th",{class:"text-center"},"Jml Sinkron"),t("th",{class:"text-center"},"Status"),t("th",{class:"text-center"},"Aksi")])],-1)),t("tbody",null,[(s(!0),k(h,null,E(o(B),a=>(s(),k("tr",{key:a.nama},[t("td",null,m(a.nama),1),t("td",W,m(a.dapodik),1),t("td",O,m(a.erapor),1),t("td",H,m(a.sinkron),1),t("td",Q,[a.sinkron?(s(),k(h,{key:0},[j(a)?(s(),l(b,{key:0,color:"warning"},{default:r(()=>e[2]||(e[2]=[u("Kurang")])),_:1})):(s(),l(b,{key:1,color:"success"},{default:r(()=>e[3]||(e[3]=[u("Lengkap")])),_:1}))],64)):(s(),l(b,{key:1,color:"error"},{default:r(()=>e[4]||(e[4]=[u("Belum")])),_:1}))]),t("td",X,[a.dapodik?(s(),l(F,{key:0,loading:o(y),disabled:o(y),size:"small",color:"success",onClick:C=>R(a.server,a.aksi)},{default:r(()=>e[5]||(e[5]=[u(" Sinkronisasi ")])),_:2},1032,["loading","disabled","onClick"])):(s(),k(h,{key:1},[u(" - ")],64))])]))),128))])]),_:1}))]),_:1})]),_:1})),g(p,{isDialogVisible:o(f),"onUpdate:isDialogVisible":e[0]||(e[0]=a=>M(f)?f.value=a:null),"confirm-color":o(_).color,"confirm-title":o(_).title,"confirm-msg":o(_).text,onConfirm:q},null,8,["isDialogVisible","confirm-color","confirm-title","confirm-msg"])])}}};export{ye as default};
