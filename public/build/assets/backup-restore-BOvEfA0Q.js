import{_ as K}from"./ConfirmDialog-BLscZHWo.js";import{u as G,c as W}from"./createUrl-8zoAcX36.js";import{$ as N}from"./api-Bkbcc4ec.js";import{V as S,a as $,c as F,b as f}from"./VCard-CswHtBsG.js";import{G as j,r as n,c as d,b as l,e as s,m as t,a2 as R,o as i,aa as T,t as r,F as b,am as A,f as h,d as a,v as g,h as M,y as z,ao as Q,$ as q}from"./main-4ibPTuoX.js";import{V as P}from"./VDivider-DBczu0Ow.js";import{V as X}from"./VAlert-DaMZodXc.js";import{V as Y}from"./VTable-CFJBDt5I.js";import{V as Z}from"./VFileInput-CjthOGiK.js";import"./VDialog-BkAb0UEZ.js";import"./VOverlay-Dt1Dy2Gr.js";import"./forwardRefs-DWGaNmQL.js";import"./scopeId-DgdHYkHx.js";import"./VImg-B9UUOYt7.js";import"./index-BxkgbwWS.js";import"./VAvatar-DuOErqu_.js";import"./VField-DDWomVtf.js";import"./VLabel-B0eCB5jg.js";import"./VChip-ClHLREYK.js";import"./VSlideGroup-DECG9arN.js";const ee={class:"mt-4 mb-4"},ae={class:"text-center"},te={key:1},Ce={__name:"backup-restore",setup(le){j(async()=>{await V()});const C=n(!0),k=n(!1),y=n([]),p=n(),V=async()=>{try{let e=(await G(W("/setting",{query:{data:"backup"}}))).data.value;y.value=e}catch(u){console.error(u)}finally{C.value=!1}},E=async()=>{console.log("prosesBackup"),k.value=!0,await N("/setting/proses-backup",{method:"POST",onResponse({response:u}){let e=u._data;p.value=e,k.value=!1,V()}})},v=n({zip_file:null}),I=n({zip_file:null}),B=n(!1),w=n(0),L=async()=>{B.value=!0;const u=new FormData;u.append("zip_file",v.value.zip_file);try{await N("/setting/upload-restore",{method:"POST",body:u,onUploadProgress:e=>{w.value=Math.round(e.loaded*100/e.total)}})}catch(e){console.error(e)}finally{v.value.zip_file=null,B.value=!1,await V()}},_=n(!1),c=n(!1),m=n({color:"",title:"",text:""}),x=n([]),D=n(),O=async u=>{D.value=u,_.value=!0},H=async()=>{x.value[D.value]=!0,await N("/setting/hapus-file",{method:"POST",body:{zip_file:D.value},onResponse({request:u,response:e,options:U}){let o=e._data;x.value[D.value]=!1,m.value=o,c.value=!0}})},J=async()=>{c.value=!1,setTimeout(()=>{m.value={color:"",title:"",text:""}},300),await V()};return(u,e)=>{const U=K;return i(),d("section",null,[l(S,{class:"mb-6"},{default:s(()=>[l($,{class:"pb-6"},{append:s(()=>[l(T,{"prepend-icon":"tabler-database",onClick:e[0]||(e[0]=o=>E("unduh")),loading:t(k),disabled:t(k)},{default:s(()=>e[5]||(e[5]=[r(" Proses Backup ")])),_:1},8,["loading","disabled"])]),default:s(()=>[l(F,null,{default:s(()=>e[4]||(e[4]=[r("Backup Database")])),_:1})]),_:1}),t(C)?(i(),d(b,{key:0},[l(P),l(f,{class:"text-center"},{default:s(()=>[l(A,{size:60,indeterminate:"",color:"error"})]),_:1})],64)):(i(),d(b,{key:1},[t(p)?(i(),h(f,{key:0},{default:s(()=>[l(X,{color:t(p).exitCode?"error":"success",variant:"tonal"},{default:s(()=>[a("h2",ee,g(t(p).message),1),a("ul",null,[(i(!0),d(b,null,M(t(p).output,o=>(i(),d("li",null,g(o),1))),256))])]),_:1},8,["color"])]),_:1})):z("",!0),l(Y,{class:"text-no-wrap"},{default:s(()=>[e[9]||(e[9]=a("thead",null,[a("tr",null,[a("th",null,"Waktu Backup"),a("th",null,"Ukuran Berkas"),a("th",{class:"text-center"},"Aksi")])],-1)),a("tbody",null,[t(y).length?(i(!0),d(b,{key:0},M(t(y),o=>(i(),d("tr",null,[a("td",null,g(o.fileDate),1),a("td",null,g(o.fileSize)+" MB",1),a("td",ae,[l(T,{size:"small",color:"success",href:`/downloads/backup/${o.fileName}`,class:"me-2"},{default:s(()=>[l(q,{start:"",icon:"tabler-download"}),e[6]||(e[6]=r(" Unduh "))]),_:2},1032,["href"]),l(T,{size:"small",color:"error",onClick:se=>O(o.fileName),loading:t(x)[o.fileName],disabled:t(x)[o.fileName]},{default:s(()=>[l(q,{start:"",icon:"tabler-trash"}),e[7]||(e[7]=r(" Hapus "))]),_:2},1032,["onClick","loading","disabled"])])]))),256)):(i(),d("tr",te,e[8]||(e[8]=[a("td",{class:"text-center",colspan:"3"},"Tidak ada data untuk ditampilkan",-1)])))])]),_:1})],64)),t(y).length?(i(),h(f,{key:2},{default:s(()=>e[10]||(e[10]=[a("p",null,"Proses restore database",-1),a("ol",{style:{margin:"0 20px 0px"}},[a("li",null,"Buka cmd/ssh"),a("li",null,[r("Jalankan: "),a("ul",{style:{margin:"0 15px 0px"}},[a("li",null,[a("code",null,"cd C:\\eRaporSMK\\dataweb"),r("[Enter]")]),a("li",null,[a("code",null,"php artisan app:restore"),r("[Enter]")]),a("li",null,[r("Jika ada notifikasi "),a("code",null,[r('Proceed to restore "e-Rapor SMK/'),a("code",null,"nama-file-database"),r('.zip" using the "pgsql" database connection. (Database: '),a("code",null,"nama-database"),r(", Host: 127.0.0.1, username: "),a("code",null,"nama-user-database"),r("): (yes/no) ["),a("span",{class:"text-warning"},"yes"),r("]")]),r(", tekan tombol Enter ")]),a("li",null,"Tunggu sampai proses restore database selesai.")])])],-1)])),_:1})):z("",!0)]),_:1}),l(S,{class:"mb-6"},{default:s(()=>[l($,{class:"pb-6"},{default:s(()=>[l(F,null,{default:s(()=>e[11]||(e[11]=[r("Restore Database")])),_:1})]),_:1}),l(P),t(C)?(i(),d(b,{key:0},[l(P),l(f,{class:"text-center"},{default:s(()=>[l(A,{size:60,indeterminate:"",color:"error"})]),_:1})],64)):z("",!0),l(f,null,{default:s(()=>[l(Z,{modelValue:t(v).zip_file,"onUpdate:modelValue":[e[1]||(e[1]=o=>t(v).zip_file=o),L],"error-messages":t(I).zip_file,accept:".zip",label:"Unggah Berkas Database (.zip)"},null,8,["modelValue","error-messages"]),t(B)?(i(),h(Q,{key:0,value:t(w),color:"primary",height:"25",class:"mt-4"},{default:s(()=>[r(g(t(w))+"% ",1)]),_:1},8,["value"])):z("",!0)]),_:1})]),_:1}),l(U,{isDialogVisible:t(_),"onUpdate:isDialogVisible":e[2]||(e[2]=o=>R(_)?_.value=o:null),isNotifVisible:t(c),"onUpdate:isNotifVisible":e[3]||(e[3]=o=>R(c)?c.value=o:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":"Tindakan ini tidak dapat dikembalikan!","confirm-color":t(m).color,"confirm-title":t(m).title,"confirm-msg":t(m).text,onConfirm:H,onClose:J},null,8,["isDialogVisible","isNotifVisible","confirm-color","confirm-title","confirm-msg"])])}}};export{Ce as default};
