import{r as A}from"./validators-CXK_eVNV.js";import{r as n,G as K,c as Y,d as r,m as a,v as y,b as t,e as s,F as z,i as J,j as Q,a as W,o as _,H as c,f as w,t as V,ap as X,aa as Z,y as ee,a8 as u,aq as ae}from"./main-BpmS5yjl.js";import{_ as te}from"./AppSelect-DbfGRlpP.js";import{_ as se}from"./AppTextField-BYQvWqvk.js";import{u as D,a as oe,b as re}from"./misc-mask-light-Dhh9fOZ0.js";import{a as L}from"./bg_login-oNs3_qaJ.js";import{l as N}from"./index-DXg9WRV2.js";import{u as le}from"./useAbility-DjEF__79.js";import{$ as ie}from"./api-CqoQuUrQ.js";import{u as ne,c as ue}from"./createUrl-jHsYqGLm.js";import{V as q,a as d}from"./VRow-BacuoGYF.js";import{V as B}from"./VImg-1iDcvPVu.js";import{V as me,b as x}from"./VCard-CHmpSx-c.js";import{V as de}from"./VForm-BtS5s1QD.js";import{V as pe}from"./VCheckbox-d5A3z2DE.js";import"./VLabel-D6Y69236.js";import"./VSelect-D2E-ncti.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-CAazeH9Z.js";import"./ssrBoot-C9ygE__7.js";import"./VAvatar-CwdAusxZ.js";import"./VDivider-gWeRf3Xl.js";import"./VOverlay-yY7p8is2.js";import"./scopeId-DiP191uI.js";import"./VMenu-RpUw0xGr.js";import"./VSelectionControl-Bjw4k3ug.js";import"./VChip-Ce3c0jwR.js";import"./VSlideGroup-ZqIn0ESw.js";/* empty css                   */import"./VField-Cktymv3Q.js";import"./index-BxkgbwWS.js";/* empty css              */const ce="/build/assets/auth-v2-login-illustration-bordered-dark-cDkPk8mY.png",fe="/build/assets/auth-v2-login-illustration-bordered-light-CIHqcIVA.png",ge={href:"javascript:void(0)"},he={class:"auth-logo d-flex align-center gap-x-3"},_e=["src"],Ve={class:"auth-title"},ve={class:"position-relative bg-background w-100 me-0"},be={class:"d-flex align-center justify-center w-100 h-100",style:{"padding-inline":"6.25rem"}},ke=["src"],ye={class:"text-h2 mb-1"},we=["src"],xe={class:"d-flex align-center flex-wrap justify-space-between my-6"},oa={__name:"login",setup(Se){const U=D(L,L,fe,ce,!0),j=D(re,oe),S=n(),l=n({email:"",password:"",semester_id:"",remember:!1}),T=J(),M=Q(),$=le(),f=n({email:void 0,password:void 0}),g=n(!1),I=n([]),C=n(""),F=()=>{N(`<strong>Selamat Datang ${C.value}</strong>
    <br>Anda telah berhasil masuk sebagai <strong>${I.value}</strong>. Sekarang Anda dapat mulai berselancar di Aplikasi e-Rapor SMK!`,{closeOnClick:!1,autoClose:5e3,position:N.POSITION.TOP_RIGHT,dangerouslyHTMLString:!0})},p=n(!1),O=async()=>{p.value=!0;try{const o=await ie("/auth/login",{method:"POST",body:{email:l.value.email,password:l.value.password,semester_id:l.value.semester_id},onResponseError({response:G}){f.value=G._data.errors,p.value=!1}}),{accessToken:e,userData:m,sekolah:k,semester:h,userAbility:i,roles:R}=o;C.value=m.name,u("userAbilityRules").value=i,$.update(i),u("userData").value=m,u("accessToken").value=e,u("sekolah").value=k,u("semester").value=h,u("roles").value=R,u("profilePhotoPath").value=m.profile_photo_path,I.value=R.join(", "),p.value=!1,await ae(()=>{M.replace(T.query.to?String(T.query.to):"/").then(()=>{F()})})}catch(o){console.error(o)}},E=()=>{var o;(o=S.value)==null||o.validate().then(({valid:e})=>{e&&O()})},v=n(!1);n(0);const P=n([]),b=n();K(async()=>{await H()});const H=async()=>{try{let e=(await ne(ue("/auth/semester"))).data.value;P.value=e.semester,l.value.semester_id=e.semester_id,v.value=e.allowRegister,e.sekolah||(v.value=!0),b.value=e.bg_login}catch(o){console.error(o)}};return(o,e)=>{const m=se,k=te,h=W("RouterLink");return _(),Y(z,null,[r("a",ge,[r("div",he,[r("img",{src:a(c).app.logo,height:"24"},null,8,_e),r("h1",Ve,y(a(c).app.title),1)])]),t(q,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:s(()=>[t(d,{md:"8",class:"d-none d-md-flex"},{default:s(()=>[r("div",ve,[r("div",be,[a(b)?(_(),w(B,{key:0,"max-width":"613",src:a(b),class:"auth-illustration mt-16 mb-2"},null,8,["src"])):(_(),w(B,{key:1,"max-width":"613",src:a(U),class:"auth-illustration mt-16 mb-2"},null,8,["src"]))]),r("img",{class:"auth-footer-mask flip-in-rtl",src:a(j),alt:"auth-footer-mask",height:"280",width:"100"},null,8,ke)])]),_:1}),t(d,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:s(()=>[t(me,{flat:"","max-width":500,class:"mt-sm-0 pa-6"},{default:s(()=>[t(x,{class:"text-center"},{default:s(()=>[r("h1",ye,[r("img",{src:a(c).app.logo,height:"28"},null,8,we),V(" "+y(a(c).app.title),1)]),r("p",null,"Versi "+y(a(c).app.version),1),e[5]||(e[5]=r("p",{class:"mb-0"},"Silahkan login untuk dapat mengakses Aplikasi",-1))]),_:1}),t(x,null,{default:s(()=>[t(de,{ref_key:"refVForm",ref:S,onSubmit:X(E,["prevent"])},{default:s(()=>[t(q,null,{default:s(()=>[t(d,{cols:"12"},{default:s(()=>[t(m,{modelValue:a(l).email,"onUpdate:modelValue":e[0]||(e[0]=i=>a(l).email=i),"error-messages":a(f).email||a(f).username,autofocus:"",label:"Email/NUPTK/NISN",placeholder:"Email/NUPTK/NISN",rules:["requiredValidator"in o?o.requiredValidator:a(A)]},null,8,["modelValue","error-messages","rules"])]),_:1}),t(d,{cols:"12"},{default:s(()=>[t(m,{modelValue:a(l).password,"onUpdate:modelValue":e[1]||(e[1]=i=>a(l).password=i),"error-messages":a(f).password,label:"Password",placeholder:"············",type:a(g)?"text":"password",autocomplete:"password","append-inner-icon":a(g)?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[2]||(e[2]=i=>g.value=!a(g)),rules:["requiredValidator"in o?o.requiredValidator:a(A)]},null,8,["modelValue","error-messages","type","append-inner-icon","rules"])]),_:1}),t(d,{cols:"12"},{default:s(()=>[t(k,{items:a(P),"item-title":"nama","item-value":"semester_id",label:"Tahun Pelajaran",modelValue:a(l).semester_id,"onUpdate:modelValue":e[3]||(e[3]=i=>a(l).semester_id=i),placeholder:"Select Item"},null,8,["items","modelValue"]),r("div",xe,[t(pe,{modelValue:a(l).remember,"onUpdate:modelValue":e[4]||(e[4]=i=>a(l).remember=i),label:"Simpan Login"},null,8,["modelValue"]),t(h,{class:"text-primary",to:{name:"lupa-password"}},{default:s(()=>e[6]||(e[6]=[V(" Lupa Password? ")])),_:1})]),t(Z,{block:"",type:"submit",loading:a(p),disabled:a(p)},{default:s(()=>e[7]||(e[7]=[V(" Login ")])),_:1},8,["loading","disabled"])]),_:1}),a(v)?(_(),w(d,{key:0,cols:"12",class:"text-center"},{default:s(()=>[e[9]||(e[9]=r("span",null,"Pengguna Baru?",-1)),t(h,{class:"text-primary ms-1",to:{name:"register"}},{default:s(()=>e[8]||(e[8]=[V(" Register Disini ")])),_:1})]),_:1})):ee("",!0)]),_:1})]),_:1},512)]),_:1}),t(x)]),_:1})]),_:1})]),_:1})],64)}}};export{oa as default};
