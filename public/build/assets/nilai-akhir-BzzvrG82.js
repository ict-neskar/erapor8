import{a as J,d as A,e as se,f as ue}from"./mixins-BjVJEZvR.js";import{r as s,G as me,f as b,e as n,o as p,b as l,t as K,m as a,am as I,ap as de,a2 as c,d as u,aa as Q,y as P,c as U,h as X,F as M,v as pe}from"./main-4ibPTuoX.js";import{_ as fe}from"./ConfirmDialog-BLscZHWo.js";import{_ as _e}from"./AppTextField-Bdwte880.js";import{_ as be}from"./ProfileSiswa-BlSG8edM.js";import{_ as ce}from"./AppSelect-DFrAhbhb.js";import{_ as ke}from"./DefaultForm-DNhwva-q.js";import{$ as F}from"./api-Bkbcc4ec.js";import{V as ge,c as ve,a as ye,b as S}from"./VCard-CswHtBsG.js";import{V as W}from"./VDivider-DBczu0Ow.js";import{V as Ve}from"./VForm-BUGxzJlr.js";import{V as O,a as g}from"./VRow-C9aDKUvo.js";import{V as he}from"./VFileInput-CjthOGiK.js";import{V as q}from"./VAlert-DaMZodXc.js";import{V as xe}from"./VTable-CFJBDt5I.js";import{V as je}from"./VOverlay-Dt1Dy2Gr.js";import"./VDialog-BkAb0UEZ.js";import"./forwardRefs-DWGaNmQL.js";import"./scopeId-DgdHYkHx.js";import"./VLabel-B0eCB5jg.js";import"./VImg-B9UUOYt7.js";/* empty css                   */import"./VField-DDWomVtf.js";import"./VAvatar-DuOErqu_.js";import"./VSelect-CJIVueWh.js";import"./VList-DRMF5v6F.js";import"./ssrBoot-CGBhTCaE.js";import"./VMenu-HPtXLDMp.js";import"./VSelectionControl-Dw3cA4UE.js";import"./VChip-ClHLREYK.js";import"./VSlideGroup-DECG9arN.js";import"./AppAutocomplete-CQHIUyq3.js";import"./filter-CCPSJzNa.js";import"./index-BxkgbwWS.js";/* empty css              */const we={key:0,class:"text-center"},Pe=["rowspan"],Te=["rowspan"],De={style:{"inline-size":"6rem"}},Ce={style:{"vertical-align":"top"},class:"pt-2"},fa={__name:"nilai-akhir",setup(Ue){const G=s(!0),L=s(!0),Y=async()=>{try{const i=await F("/setting/status-penilaian",{method:"POST",body:{sekolah_id:A.sekolah_id,semester_id:J.semester_id}});L.value=i}catch(i){console.error(i)}finally{G.value=!1}};me(async()=>{await Y()});const E=s(""),r=s({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,bentuk_penilaian:null,template_excel:null}),_=s({akhir:{},kompeten:{}}),v=s({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,bentuk_penilaian:null,template_excel:null}),o=s({rombel:[],mapel:[],teknik:[],siswa:[],tp:[]}),m=s({rombel:!1,mapel:!1,bentuk_penilaian:!1,body:!1}),y=s(!1),T=s(!1),N=s(!1),V=s(!1),H=s(""),h=s({color:"",title:"",text:""}),Z=async()=>{T.value=!0;const i={...x,...r.value,..._.value};await F("/penilaian/simpan",{method:"POST",body:i,onResponse({response:e}){let f=e._data;T.value=!1,f.errors?v.value=f.errors:(V.value=!0,h.value=f)}})},x={opsi:"nilai-akhir",semester_id:J.semester_id,user_id:A.user_id,guru_id:A.guru_id,sekolah_id:A.sekolah_id,merdeka:!1},B=s(!1),ee=()=>{B.value=!0,r.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,bentuk_penilaian:null,template_excel:null},_.value={akhir:{},kompeten:{}},v.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,bentuk_penilaian:null,template_excel:null},o.value={rombel:[],mapel:[],teknik:[],siswa:[],tp:[]},m.value={rombel:!1,mapel:!1,bentuk_penilaian:!1,body:!1},y.value=!1,T.value=!1,N.value=!1,V.value=!1,H.value="",h.value={color:"",title:"",text:""}},j=s(!1),z=async i=>{const e={...i,...x};await F("/referensi/get-data",{method:"POST",body:e,onResponse({response:f}){o.value.siswa=[],y.value=!1;let d=f._data;i.data=="rombel"&&(o.value.rombel=d),i.data=="mapel"&&(o.value.mapel=d.mapel,x.merdeka=d.merdeka,j.value=!!d.rombel.kunci_nilai),i.data=="teknik"&&(o.value.teknik=d)}})},ae=async i=>{r.value.rombongan_belajar_id=null,r.value.pembelajaran_id=null,r.value.mata_pelajaran_id=null,i&&(m.value.rombel=!0,await z({data:"rombel",nilai:1,tingkat:i}).then(()=>{m.value.rombel=!1}))},le=async i=>{r.value.pembelajaran_id=null,r.value.mata_pelajaran_id=null,i&&(m.value.mapel=!0,await z({data:"mapel",nilai:1,rombongan_belajar_id:i}).then(()=>{m.value.mapel=!1}))},te=async i=>{r.value.bentuk_penilaian=null,i&&(m.value.bentuk_penilaian=!0,await z({data:"teknik"}).then(()=>{m.value.bentuk_penilaian=!1}))},$=s(!1),ne=async i=>{if(o.value.siswa=[],o.value.tp=[],i){const e={...r.value,...x};m.value.body=!0,y.value=!1,await F("/penilaian/get-nilai-akhir",{method:"POST",body:e,onResponse({response:f}){let d=f._data;o.value.siswa=d.data_siswa,o.value.tp=d.data_tp,E.value="",r.value.bentuk_penilaian=="asesmen"?$.value=!0:($.value=!1,E.value=`/downloads/template-nilai-akhir/${r.value.pembelajaran_id}`),d.data_siswa.forEach(k=>{r.value.bentuk_penilaian=="asesmen"?_.value.akhir[k.anggota_rombel_id]=k.nilai_asesmen:_.value.akhir[k.anggota_rombel_id]=k.nilai_akhir,d.data_tp.forEach(R=>{const D=k.capaian_kompeten.find(t=>t.tp_id===R.tp_id);_.value.kompeten[k.anggota_rombel_id+"#"+R.tp_id]=D==null?void 0:D.kompeten})}),y.value=!0,m.value.body=!1}})}},ie=()=>{ee()},w=s(!1),oe=async i=>{w.value=!0;const e=new FormData;e.append("template_excel",i),e.append("rombongan_belajar_id",r.value.rombongan_belajar_id),e.append("pembelajaran_id",r.value.pembelajaran_id),e.append("sekolah_id",x.sekolah_id),e.append("merdeka",x.merdeka),await F("/penilaian/upload-nilai",{method:"POST",body:e,onResponse({response:f}){let d=f._data;V.value=!0,h.value=d,w.value=!1}})};return(i,e)=>{const f=ke,d=ce,k=be,R=_e,D=fe;return p(),b(ge,{class:"mb-6"},{default:n(()=>[l(ye,{class:"pb-4"},{default:n(()=>[l(ve,null,{default:n(()=>e[11]||(e[11]=[K("Input Nilai Akhir")])),_:1})]),_:1}),l(W),a(G)?(p(),b(S,{key:0,class:"text-center"},{default:n(()=>[l(I,{size:60,indeterminate:"",color:"error",class:"my-10"})]),_:1})):a(L)?(p(),b(Ve,{key:1,onSubmit:de(Z,["prevent"])},{default:n(()=>[l(S,null,{default:n(()=>[l(O,null,{default:n(()=>[l(f,{form:a(r),"onUpdate:form":e[0]||(e[0]=t=>c(r)?r.value=t:null),errors:a(v),"onUpdate:errors":e[1]||(e[1]=t=>c(v)?v.value=t:null),arrayData:a(o),"onUpdate:arrayData":e[2]||(e[2]=t=>c(o)?o.value=t:null),loading:a(m),"onUpdate:loading":e[3]||(e[3]=t=>c(m)?m.value=t:null),resetForm:a(B),"onUpdate:resetForm":e[4]||(e[4]=t=>c(B)?B.value=t:null),isKunci:a(j),"onUpdate:isKunci":e[5]||(e[5]=t=>c(j)?j.value=t:null),onTingkat:ae,onRombongan_belajar_id:le,onPembelajaran_id:te},null,8,["form","errors","arrayData","loading","resetForm","isKunci"]),l(g,{cols:"12"},{default:n(()=>[l(O,{"no-gutters":""},{default:n(()=>[l(g,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:n(()=>e[12]||(e[12]=[u("label",{class:"v-label text-body-2 text-high-emphasis",for:"bentuk_penilaian"},"Bentuk Penilaian",-1)])),_:1}),l(g,{cols:"12",md:"9"},{default:n(()=>[l(d,{modelValue:a(r).bentuk_penilaian,"onUpdate:modelValue":[e[6]||(e[6]=t=>a(r).bentuk_penilaian=t),ne],placeholder:"== Pilih Bentuk Penilaian ==",items:"bentukPenilaian"in i?i.bentukPenilaian:a(se),clearable:"","clear-icon":"tabler-x","error-messages":a(v).bentuk_penilaian,loading:a(m).bentuk_penilaian,disabled:a(m).bentuk_penilaian||a(j)},null,8,["modelValue","items","error-messages","loading","disabled"])]),_:1})]),_:1})]),_:1}),a(o).siswa.length&&a(o).tp.length&&!a($)?(p(),b(g,{key:0,cols:"12"},{default:n(()=>[l(O,{"no-gutters":""},{default:n(()=>[l(g,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:n(()=>e[13]||(e[13]=[u("label",{class:"v-label text-body-2 text-high-emphasis",for:"template_excel"},"Template Excel",-1)])),_:1}),l(g,{cols:"12",md:"9"},{default:n(()=>[l(O,{"no-gutters":""},{default:n(()=>[l(g,{cols:"6"},{default:n(()=>[l(he,{id:"template_excel",modelValue:a(r).template_excel,"onUpdate:modelValue":[e[7]||(e[7]=t=>a(r).template_excel=t),oe],"error-messages":a(v).template_excel,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",label:"Unggah Template Excel"},null,8,["modelValue","error-messages"])]),_:1}),l(g,{cols:"6"},{default:n(()=>[l(Q,{color:"primary",class:"ms-3",href:a(E),target:"_blank"},{default:n(()=>e[14]||(e[14]=[K(" Unduh Template Nilai Akhir ")])),_:1},8,["href"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):P("",!0)]),_:1}),a(m).body?(p(),U("div",we,[l(I,{size:60,indeterminate:"",color:"error",class:"my-10"})])):P("",!0),a(j)?(p(),b(q,{key:1,color:"error",class:"text-center my-4",variant:"tonal"},{default:n(()=>e[15]||(e[15]=[u("h2",{class:"mt-4 mb-4"},"Penilaian tidak aktif. Silahkan hubungi Wali Kelas!",-1)])),_:1})):P("",!0)]),_:1}),l(W),a(o).siswa.length&&a(o).tp.length&&!a(w)?(p(),b(xe,{key:0},{default:n(()=>[e[16]||(e[16]=u("thead",null,[u("tr",null,[u("th",{class:"text-center"},"Nama Peserta Didik"),u("th",{class:"text-center"},"Nilai Akhir"),u("th",{class:"text-center"},"Ketercapaian Kompetensi"),u("th",null,"Deskripsi Tujuan Pembelajaran")])],-1)),u("tbody",null,[(p(!0),U(M,null,X(a(o).siswa,t=>(p(),U(M,null,[u("tr",null,[u("td",{rowspan:a(o).tp.length+1,class:"text-no-wrap pt-2",style:{"vertical-align":"top"}},[l(k,{item:t},null,8,["item"])],8,Pe),u("td",{rowspan:a(o).tp.length+1,style:{"vertical-align":"top"},class:"pt-2"},[u("div",De,[l(R,{type:"number",modelValue:a(_).akhir[t.anggota_rombel_id],"onUpdate:modelValue":C=>a(_).akhir[t.anggota_rombel_id]=C,disabled:a($)},null,8,["modelValue","onUpdate:modelValue","disabled"])])],8,Te)]),(p(!0),U(M,null,X(a(o).tp,(C,Fe)=>(p(),U("tr",null,[u("td",Ce,[l(d,{modelValue:a(_).kompeten[t.anggota_rombel_id+"#"+C.tp_id],"onUpdate:modelValue":re=>a(_).kompeten[t.anggota_rombel_id+"#"+C.tp_id]=re,placeholder:"== Pilih Capaian ==",items:"dataCapaian"in i?i.dataCapaian:a(ue),clearable:"","clear-icon":"tabler-x",style:{"inline-size":"12rem"}},null,8,["modelValue","onUpdate:modelValue","items"])]),u("td",null,pe(C.deskripsi),1)]))),256))],64))),256))])]),_:1})):P("",!0),l(W),a(y)&&a(o).tp.length?(p(),b(S,{key:1,class:"d-flex justify-end flex-wrap gap-3 pt-5 overflow-visible"},{default:n(()=>[l(Q,{variant:"elevated",type:"submit",loading:a(T),disabled:a(T)},{default:n(()=>e[17]||(e[17]=[K(" Simpan ")])),_:1},8,["loading","disabled"])]),_:1})):P("",!0),a(y)&&!a(o).tp.length?(p(),b(S,{key:2,class:"d-flex justify-end flex-wrap gap-3 pt-5 overflow-visible"},{default:n(()=>[l(q,{color:"error"},{default:n(()=>e[18]||(e[18]=[K("Belum ada TP untuk mata pelajaran ini.")])),_:1})]),_:1})):P("",!0)]),_:1})):(p(),b(S,{key:2},{default:n(()=>[l(q,{color:"error",class:"text-center my-4",variant:"tonal"},{default:n(()=>e[19]||(e[19]=[u("h2",{class:"mt-4 mb-4"},"Penilaian tidak aktif. Silahkan hubungi administrator!",-1)])),_:1})]),_:1})),l(D,{isDialogVisible:a(N),"onUpdate:isDialogVisible":e[8]||(e[8]=t=>c(N)?N.value=t:null),isNotifVisible:a(V),"onUpdate:isNotifVisible":e[9]||(e[9]=t=>c(V)?V.value=t:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":a(H),"confirm-color":a(h).color,"confirm-title":a(h).title,"confirm-msg":a(h).text,onClose:ie},null,8,["isDialogVisible","isNotifVisible","confirmation-text","confirm-color","confirm-title","confirm-msg"]),l(je,{modelValue:a(w),"onUpdate:modelValue":e[10]||(e[10]=t=>c(w)?w.value=t:null),contained:"",persistent:"","scroll-strategy":"none",class:"align-center justify-center"},{default:n(()=>[l(I,{indeterminate:""})]),_:1},8,["modelValue"])]),_:1})}}};export{fa as default};
