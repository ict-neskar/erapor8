import{d as x,a as T,$ as D}from"./mixins-1QYt5fru.js";import{_ as E}from"./AlertDialog-nRwOaxER.js";import{_ as G}from"./DialogCloseBtn-B69SY-1b.js";import{u as q,c as F}from"./createUrl-BlayIOuc.js";import{$ as J}from"./api-CiS_WuT0.js";import{V as A,a as V}from"./VRow-BWoXzrFX.js";import{V as H}from"./VDialog-DALwxD56.js";import{b as _,V as p}from"./VCard-cOUOYXWj.js";import{r as i,G as O,c as b,b as l,e as a,m as n,f as u,y as M,a2 as R,a as W,o as s,am as C,d as e,v as d,t as o,aa as Y,F as Q,h as X}from"./main-Dl0rUCYh.js";import{V as U}from"./VTable-DOTAg6_r.js";import{V as j}from"./VAlert-B2ccayhE.js";import"./index-BxkgbwWS.js";/* empty css              */import"./VOverlay-DA1Ejrlc.js";import"./forwardRefs-DWGaNmQL.js";import"./VImg-DiBI_SCk.js";import"./VAvatar-AahfVeEd.js";const Z={width:"60%"},ee={class:"text-white"},te={class:"text-center"},ae={class:"text-center"},le={key:1},ne={class:"text-center"},be={__name:"erapor",setup(oe){const k=i(!0),y=i(!1),h=i({color:"",title:"",text:""});O(async()=>{await S()});const $=i(),K=i([]),g=i(0),v=i(),N=i(""),S=async()=>{try{let t=(await q(F("/sinkronisasi/erapor",{query:{sekolah_id:x.sekolah_id,semester_id:T.semester_id,user_id:x.user_id}}))).data.value;$.value=t.last_sync,K.value=t.table_sync,g.value=t.jumlah,v.value=t.error,N.value=t.message}catch(r){console.error(r)}finally{k.value=!1}},f=i(!1);g.value>1e3&&(f.value=!0);const w=i(!1),z=async()=>{w.value=!0,await J("/sinkronisasi/kirim-data",{method:"POST",body:{sekolah_id:x.sekolah_id,semester_id:T.semester_id,user_id:x.user_id},onResponse({request:r,response:t,options:B}){let c=t._data;w.value=!1,y.value=!0,h.value={color:c.color,title:c.title,text:c.text}}})},I=()=>{S()};return(r,t)=>{const B=W("font-awesome-icon"),c=G,L=E;return s(),b("div",null,[l(A,null,{default:a(()=>[l(V,{cols:"6",xl:"8",md:"8",sm:"6"},{default:a(()=>[n(k)?(s(),u(p,{key:0},{default:a(()=>[l(_,{class:"text-center"},{default:a(()=>[l(C,{size:60,indeterminate:"",color:"error"})]),_:1})]),_:1})):(s(),u(p,{key:1},{default:a(()=>[l(U,{class:"text-no-wrap"},{default:a(()=>[e("tbody",null,[e("tr",null,[t[3]||(t[3]=e("td",{rowspan:"3",width:"10%",style:{"border-right":"1px solid #dddddd"}},[e("img",{src:"/images/logo/logo-small.png",alt:"Logo e-Rapor SMK",style:{"max-width":"100px"}})],-1)),t[4]||(t[4]=e("td",{width:"30%"},"   NPSN Sekolah",-1)),e("td",Z,d(("$sekolah"in r?r.$sekolah:n(D)).npsn),1)]),e("tr",null,[t[5]||(t[5]=e("td",null,"Nama Sekolah",-1)),e("td",null,d(("$sekolah"in r?r.$sekolah:n(D)).alamat),1)]),e("tr",null,[t[6]||(t[6]=e("td",null,"Desa Kelurahan Sekolah",-1)),e("td",null,d(("$sekolah"in r?r.$sekolah:n(D)).desa_kelurahan),1)])])]),_:1})]),_:1}))]),_:1}),l(V,{cols:"6",xl:"4",md:"4",sm:"6"},{default:a(()=>[n(k)?(s(),u(p,{key:0},{default:a(()=>[l(_,{class:"text-center"},{default:a(()=>[l(C,{size:60,indeterminate:"",color:"error"})]),_:1})]),_:1})):(s(),u(p,{key:1},{default:a(()=>[l(_,{class:"text-center"},{default:a(()=>[e("p",null,[t[7]||(t[7]=o("Pengiriman data terakhir dilakukan pada ")),t[8]||(t[8]=e("br",null,null,-1)),e("strong",null,d(n($)),1)]),l(Y,{loading:n(w),disabled:n(w)||n(v)||!n(g),size:"large",color:"success",onClick:z},{default:a(()=>[l(B,{icon:"fa-solid fa-cloud-arrow-up"}),t[9]||(t[9]=o("   ")),t[10]||(t[10]=e("strong",null,"KIRIM DATA",-1))]),_:1},8,["loading","disabled"])]),_:1})]),_:1}))]),_:1})]),_:1}),n(k)?M("",!0):(s(),u(A,{key:0},{default:a(()=>[l(V,{cols:"12"},{default:a(()=>[l(j,{color:"secondary",class:"text-center"},{default:a(()=>t[11]||(t[11]=[e("h3",{class:"text-white"},"DATA YANG MENGALAMI PERUBAHAN",-1)])),_:1}),n(v)?(s(),u(j,{key:0,color:"error",class:"text-center mt-4"},{default:a(()=>[e("h3",ee,d(n(N)),1)]),_:1})):M("",!0)]),_:1})]),_:1})),l(A,null,{default:a(()=>[l(V,{cols:"12"},{default:a(()=>[n(k)?(s(),u(p,{key:0},{default:a(()=>[l(_,{class:"text-center"},{default:a(()=>[l(C,{size:60,indeterminate:"",color:"error"})]),_:1})]),_:1})):(s(),u(p,{key:1},{default:a(()=>[l(U,{class:"text-no-wrap"},{default:a(()=>[t[14]||(t[14]=e("thead",null,[e("tr",null,[e("th",{class:"text-center",width:"5%"},"No"),e("th",{width:"80%"},"Data"),e("th",{class:"text-center",width:"15%"},"Jml Data")])],-1)),e("tbody",null,[n(g)?(s(!0),b(Q,{key:0},X(n(K),(m,P)=>(s(),b("tr",{key:P},[e("td",te,d(P+1),1),e("td",null,d(m.data),1),e("td",ae,d(m.count),1)]))),128)):(s(),b("tr",le,t[12]||(t[12]=[e("td",{colspan:"3",class:"text-center"},"Tidak ada data yang mengalami perubahan",-1)])))]),e("tfoot",null,[e("tr",null,[t[13]||(t[13]=e("th",{colspan:"2",class:"text-right"},"Jumlah",-1)),e("th",ne,d(n(g)),1)])])]),_:1})]),_:1}))]),_:1})]),_:1}),l(H,{modelValue:n(f),"onUpdate:modelValue":t[1]||(t[1]=m=>R(f)?f.value=m:null),width:"800"},{default:a(()=>[l(c,{onClick:t[0]||(t[0]=m=>f.value=!n(f))}),l(p,{title:"Informasi"},{default:a(()=>[l(_,null,{default:a(()=>t[15]||(t[15]=[e("p",null,[o("Terdeteksi jumlah data yang akan dikirim melebihi 1.000 row. Sangat disarankan melakukan pengiriman data melalui "),e("code",null,"Command Prompt"),o(" untuk menghindari kegagalan pengiriman data.")],-1),e("p",null,[o("Cara melakukan pengiriman data melalui "),e("code",null,"Command Prompt"),o(":")],-1),e("p",null,[o("Untuk Pengguna "),e("strong",null,"Windows")],-1),e("ol",{style:{"padding-left":"20px"}},[e("li",null,"Buka CMD"),e("li",null,[o("Ketik: "),e("code",null,"cd c:\\eRaporSMK\\dataweb"),o(" [enter]")]),e("li",null,[o("Ketik: "),e("code",null,"php artisan kirim:erapor"),o(" [enter]")]),e("li",null,"Ketikkan email administrator"),e("li",null,"Tunggu hingga proses pengiriman data selesai.")],-1),e("p",null,[o("Untuk Pengguna "),e("strong",null,"Linux")],-1),e("ol",{style:{"padding-left":"20px"}},[e("li",null,[o("Buka Aplikasi Putty dan login ke "),e("code",null,"shh")]),e("li",null,[o("Ketik: "),e("code",null,[o("cd /var/www/html/dataweb"),e("sup",null,"*")]),o(" [enter]")]),e("li",null,[o("Ketik: "),e("code",null,"php artisan kirim:erapor"),o(" [enter]")]),e("li",null,"Ketikkan email administrator"),e("li",null,"Tunggu hingga proses pengiriman data selesai.")],-1),e("p",null,[o("Keterangan: "),e("br"),o(" * : Sesuaikan dengan direktori root folder aplikasi e-Rapor SMK di install "),e("br"),o(" Untuk mengirimkan seluruh data yang tersimpan di database tanpa filter apapun, jalankan perintah: "),e("code",null,"php artisan kirim:erapor --force")],-1)])),_:1})]),_:1})]),_:1},8,["modelValue"]),l(L,{isDialogVisible:n(y),"onUpdate:isDialogVisible":t[2]||(t[2]=m=>R(y)?y.value=m:null),"confirm-color":n(h).color,"confirm-title":n(h).title,"confirm-msg":n(h).text,onConfirm:I},null,8,["isDialogVisible","confirm-color","confirm-title","confirm-msg"])])}}};export{be as default};
