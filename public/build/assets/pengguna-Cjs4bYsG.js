import{a as w,d as W}from"./mixins-I8SXeutZ.js";import{_ as ke}from"./AlertDialog-R4H2d-YB.js";import{_ as be}from"./ConfirmDialog-B0Bc_YJ5.js";import{_ as ye}from"./DialogCloseBtn-CpiGqbub.js";import{_ as _e}from"./TablePagination-fG2MYBNV.js";import{_ as Ve}from"./AppTextField-DGISkcON.js";import{_ as xe}from"./AppSelect-D1gjRk4-.js";import{b as we}from"./index-NOZ-zHIz.js";import{u as De,c as Pe}from"./createUrl-CexWNLWx.js";import{$ as L}from"./api-CAM2bx0j.js";import{V as O,a as Ce,c as $e,b as D}from"./VCard-DRBiftP4.js";import{V as X}from"./VDialog-BP5oy-x4.js";import{V as Y}from"./VDivider-DgEwy873.js";import{V as Ae}from"./VSpacer-D5BlabPF.js";import{r,G as Te,w as Z,c as V,b as t,e as n,m as l,a2 as P,o as v,t as g,d as s,aa as b,v as c,F as T,f as q,h as ee,y as le}from"./main-DOWoIBhU.js";import{V as Re}from"./VDataTableServer-BNn81j7f.js";import{V as Ue}from"./VAvatar-B-Z9vLfD.js";import{V as Se}from"./VImg-DYyAcwaz.js";import{V as Be}from"./VChip-Tdr48uqn.js";import{V as ae}from"./VTable-C1nYsmx8.js";import{V as Ne}from"./VCheckbox-BmrthuXl.js";import"./VLabel-Hm2kl-Y1.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-DWH4RJSa.js";import"./VOverlay-Cnf91z5i.js";import"./VMenu-DeAbbdJl.js";import"./VSelectionControl-C8KMTZZ4.js";import"./index-BxkgbwWS.js";/* empty css              */import"./filter-CR6gUgAk.js";const he={class:"me-3 d-flex gap-3"},Le={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},qe={style:{"inline-size":"15.625rem"}},ze={class:"d-flex align-center gap-x-4"},Ie={class:"d-flex flex-column"},je={class:"text-base"},He={class:"text-sm"},Qe={class:"text-center"},Vl={__name:"pengguna",setup(Fe){const i=r({page:1,itemsPerPage:10,searchQuery:"",selectedRole:null,sortby:"name",sortbydesc:"ASC"}),te=[{title:"Pengguna",key:"name",nowrap:!0},{title:"Jenis Pengguna",key:"roles",sortable:!1},{title:"Terakhir Login",key:"login_terakhir",sortable:!1},{title:"password",key:"password",sortable:!1},{title:"Aksi",key:"actions",align:"center",sortable:!1,nowrap:!0}],z=r([]),R=r(0),y=r([]),I=r(!1);Te(async()=>{await j()}),Z(i,async()=>{await j()},{deep:!0}),Z(()=>i.value.searchQuery,()=>{i.value.page=1});const se=o=>{var e,u;i.value.sortby=(e=o[0])==null?void 0:e.key,i.value.sortbydesc=(u=o[0])==null?void 0:u.order},j=async()=>{I.value=!0,z.value=[],R.value=[],y.value=[];try{let e=(await De(Pe("/setting/users",{query:{q:i.value.searchQuery,page:i.value.page,per_page:i.value.itemsPerPage,periode_aktif:w.nama,sekolah_id:W.sekolah_id,role_id:i.value.selectedRole,sortby:i.value.sortby,sortbydesc:i.value.sortbydesc}}))).data;z.value=e.value.data.data,R.value=e.value.data.total,y.value=e.value.roles}catch(o){console.error(o)}finally{I.value=!1}},C=r([]),oe=o=>{var e=o.map(u=>u.display_name);return e.join(", ")},G=(o,e)=>e?we.compareSync(e,o):!1,k=r(!1),x=r(!1),ne=async()=>{x.value=!0},E=async o=>{k.value=!0,await L("/setting/generate-pengguna",{method:"POST",body:{aksi:o,semester_id:w.semester_id,sekolah_id:W.sekolah_id,periode_aktif:w.nama},onResponse({request:e,response:u,options:f}){let d=u._data;k.value=!1,x.value=!1,p.value.color=d.color,p.value.title=d.title,p.value.text=d.text,A.value=!0}})},U=r([]),_=r(!1),S=r(!1),$=r(!1),J=r(),m=r({userId:null,nama:null,email:null,password:null,defaultPassword:null,lastLogin:null}),K=r([]),H=r([]),M=async o=>{U.value[o]=!0,await L("/setting/detil-user",{method:"POST",body:{user_id:o,periode_aktif:w.nama},onResponse({request:e,response:u,options:f}){let d=u._data;U.value[o]=!1,J.value=`Detil ${d.user.name}`,m.value.userId=d.user.user_id,m.value.nama=d.user.name,m.value.email=d.user.email,m.value.password=d.user.password,m.value.defaultPassword=d.user.default_password,m.value.lastLogin=d.user.login_terakhir,H.value=d.roles,_.value=!0,K.value=d.permission}})},Q=(o,e)=>{let u=o.filter(f=>f.id===e);return u.length?u[0].display_name:"-"},ie=(o,e)=>{let u=o.filter(f=>f.id===e);return u.length?u[0].name:"-"},B=r([]),F=r(),N=r({user_id:null,role:null,periode_aktif:null}),re=(o,e)=>{F.value=`${o}-${e}`,B.value[F.value]=!0,S.value=!0,N.value.role=o,N.value.periode_aktif=e},p=r({color:null,title:null,text:null}),ue=[7,8,9],de=async o=>{o&&await L("/setting/hapus-akses",{method:"POST",body:{user_id:m.value.userId,role:N.value.role,periode_aktif:N.value.periode_aktif},onResponse({request:e,response:u,options:f}){let d=u._data;p.value=d,$.value=!0}}),B.value[F.value]=!1},A=r(!1),me=async()=>{await L("/setting/update-akses",{method:"POST",body:{user_id:m.value.userId,akses:C.value,periode_aktif:w.nama},onResponse({request:o,response:e,options:u}){let f=e._data;p.value.color=f.color,p.value.title=f.title,p.value.text=f.text,A.value=!0}})},pe=()=>{_.value=!1,C.value=[],$.value=!1,setTimeout(()=>{p.value={color:"",title:"",text:""}},300),j()},fe=o=>{M(m.value.userId)};return(o,e)=>{const u=xe,f=Ve,d=_e,ve=ye,ge=be,ce=ke;return v(),V("section",null,[t(O,{class:"mb-6"},{default:n(()=>[t(Ce,{class:"pb-4"},{default:n(()=>[t($e,null,{default:n(()=>e[14]||(e[14]=[g("Akses Pengguna")])),_:1})]),_:1}),t(Y),t(D,{class:"d-flex flex-wrap gap-4"},{default:n(()=>[s("div",he,[t(u,{modelValue:l(i).itemsPerPage,"onUpdate:modelValue":e[0]||(e[0]=a=>l(i).itemsPerPage=a),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}],style:{"inline-size":"6.25rem"}},null,8,["modelValue"])]),t(Ae),s("div",Le,[s("div",qe,[t(f,{modelValue:l(i).searchQuery,"onUpdate:modelValue":e[1]||(e[1]=a=>l(i).searchQuery=a),placeholder:"Cari Data"},null,8,["modelValue"])]),t(u,{modelValue:l(i).selectedRole,"onUpdate:modelValue":e[2]||(e[2]=a=>l(i).selectedRole=a),placeholder:"Filter Hak Akses",items:l(y),clearable:"","clear-icon":"tabler-x",style:{"inline-size":"15rem"},"item-title":"display_name","item-value":"name"},null,8,["modelValue","items"]),t(b,{"prepend-icon":"tabler-bolt",onClick:ne},{default:n(()=>e[15]||(e[15]=[g(" Atur Ulang ")])),_:1})])]),_:1}),t(Y),t(Re,{items:l(z),"server-items-length":l(R),headers:te,options:l(i),loading:l(I),"loading-text":"Loading...","onUpdate:sortBy":se},{"item.name":n(({item:a})=>[s("div",ze,[t(Ue,{size:"34",variant:a.profile_photo_path?void 0:"tonal",color:a.profile_photo_path?void 0:"success"},{default:n(()=>[t(Se,{src:a.profile_photo_path},null,8,["src"])]),_:2},1032,["variant","color"]),s("div",Ie,[s("h6",je,c(a.name),1),s("div",He,c(a.email),1)])])]),"item.roles":n(({item:a})=>[g(c(oe(a.roles)),1)]),"item.password":n(({item:a})=>[G(a.password,a.default_password)?(v(),V(T,{key:0},[g(c(a.default_password),1)],64)):(v(),q(Be,{key:1,size:"x-small",color:"error"},{default:n(()=>e[16]||(e[16]=[g(" Custom ")])),_:1}))]),"item.actions":n(({item:a})=>[t(b,{loading:l(U)[a.user_id],disabled:l(U)[a.user_id],color:"warning",icon:"tabler-eye",onClick:h=>M(a.user_id)},null,8,["loading","disabled","onClick"])]),bottom:n(()=>[t(d,{page:l(i).page,"onUpdate:page":e[3]||(e[3]=a=>l(i).page=a),"items-per-page":l(i).itemsPerPage,"total-items":l(R)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items","server-items-length","options","loading"])]),_:1}),t(X,{modelValue:l(_),"onUpdate:modelValue":e[6]||(e[6]=a=>P(_)?_.value=a:null),width:"800"},{default:n(()=>[t(ve,{onClick:e[4]||(e[4]=a=>_.value=!l(_))}),t(O,{title:l(J),class:"pb-8"},{default:n(()=>[t(ae,{class:"text-no-wrap"},{default:n(()=>[s("tbody",null,[s("tr",null,[e[17]||(e[17]=s("td",null,"Nama",-1)),s("td",null,c(l(m).nama),1)]),s("tr",null,[e[18]||(e[18]=s("td",null,"Email",-1)),s("td",null,c(l(m).email),1)]),s("tr",null,[e[19]||(e[19]=s("td",null,"Password",-1)),s("td",null,[G(l(m).password,l(m).defaultPassword)?(v(),V(T,{key:0},[g(c(l(m).defaultPassword),1)],64)):(v(),V(T,{key:1},[g(" Custom | Reset Password ")],64))])]),s("tr",null,[e[20]||(e[20]=s("td",null,"Terakhir Login",-1)),s("td",null,c(l(m).lastLogin),1)])])]),_:1}),t(D,null,{default:n(()=>e[21]||(e[21]=[s("h4",null,"Hak Akses yang Dimiliki",-1)])),_:1}),t(ae,{class:"text-no-wrap"},{default:n(()=>[e[22]||(e[22]=s("thead",null,[s("tr",null,[s("th",null,"Tahun Pelajaran"),s("th",null,"Hak Akses"),s("th",{class:"text-center"},"Aksi")])],-1)),s("tbody",null,[(v(!0),V(T,null,ee(l(K),(a,h)=>(v(),V("tr",{key:h},[s("td",null,c(a.name),1),s("td",null,c(Q(l(y),a.pivot.role_id)),1),s("td",Qe,[ue.includes(a.pivot.role_id)?(v(),q(b,{key:0,loading:l(B)[`${Q(l(y),a.pivot.role_id)}-${a.name}`],disabled:l(B)[`${Q(l(y),a.pivot.role_id)}-${a.name}`],color:"error",icon:"tabler-trash",onClick:Oe=>re(ie(l(y),a.pivot.role_id),a.name)},null,8,["loading","disabled","onClick"])):le("",!0)])]))),128))])]),_:1}),l(H).length?(v(),q(D,{key:0},{default:n(()=>[s("h4",null,"Tambah Hak Akses di Tahun Pelajaran "+c(("$semester"in o?o.$semester:l(w)).nama),1),(v(!0),V(T,null,ee(l(H),a=>(v(),q(Ne,{key:a,modelValue:l(C),"onUpdate:modelValue":e[5]||(e[5]=h=>P(C)?C.value=h:null),label:a.text,value:a.value},null,8,["modelValue","label","value"]))),128))]),_:1})):le("",!0),t(D,{class:"d-flex justify-end"},{default:n(()=>[t(b,{onClick:me},{default:n(()=>e[23]||(e[23]=[g(" Simpan ")])),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),t(ge,{isDialogVisible:l(S),"onUpdate:isDialogVisible":e[7]||(e[7]=a=>P(S)?S.value=a:null),isNotifVisible:l($),"onUpdate:isNotifVisible":e[8]||(e[8]=a=>P($)?$.value=a:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":"Tindakan ini tidak dapat dikembalikan!","confirm-color":l(p).color,"confirm-title":l(p).title,"confirm-msg":l(p).text,onConfirm:de,onClose:fe},null,8,["isDialogVisible","isNotifVisible","confirm-color","confirm-title","confirm-msg"]),t(ce,{isDialogVisible:l(A),"onUpdate:isDialogVisible":e[9]||(e[9]=a=>P(A)?A.value=a:null),"confirm-color":l(p).color,"confirm-title":l(p).title,"confirm-msg":l(p).text,onConfirm:pe},null,8,["isDialogVisible","confirm-color","confirm-title","confirm-msg"]),t(X,{"max-width":"500",modelValue:l(x),"onUpdate:modelValue":e[13]||(e[13]=a=>P(x)?x.value=a:null)},{default:n(()=>[t(O,{class:"text-center px-10 py-6"},{default:n(()=>[t(D,null,{default:n(()=>[t(b,{icon:"",variant:"outlined",color:"warning",class:"my-4",style:{"block-size":"88px","inline-size":"88px","pointer-events":"none"}},{default:n(()=>e[24]||(e[24]=[s("span",{class:"text-5xl"},"!",-1)])),_:1}),e[25]||(e[25]=s("h6",{class:"text-lg font-weight-medium"}," Generate Pengguna ",-1)),e[26]||(e[26]=s("p",null,"Silahkan Pilih Jenis Akun",-1))]),_:1}),t(D,{class:"d-flex align-center justify-center gap-2"},{default:n(()=>[t(b,{variant:"elevated",color:"primary",onClick:e[10]||(e[10]=a=>E("ptk")),loading:l(k),disabled:l(k)},{default:n(()=>e[27]||(e[27]=[g(" Akun PTK ")])),_:1},8,["loading","disabled"]),t(b,{variant:"elevated",color:"error",onClick:e[11]||(e[11]=a=>E("pd")),loading:l(k),disabled:l(k)},{default:n(()=>e[28]||(e[28]=[g(" Akun PD ")])),_:1},8,["loading","disabled"]),t(b,{color:"secondary",variant:"tonal",onClick:e[12]||(e[12]=a=>x.value=!1),loading:l(k),disabled:l(k)},{default:n(()=>e[29]||(e[29]=[g(" Batal ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{Vl as default};
