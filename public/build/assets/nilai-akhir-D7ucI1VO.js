import{a as le,d as E,e as te,f as ne}from"./mixins-CKTOKEkb.js";import{r as m,f as N,e as i,o as _,b as l,t as O,m as a,a2 as c,d as u,aa as M,y as S,c as T,am as q,h as L,F as z,ap as ie,v as oe}from"./main-Ba5E192h.js";import{_ as re}from"./ConfirmDialog-bk0D98nm.js";import{_ as se}from"./AppTextField-C7kSSQsT.js";import{_ as me}from"./ProfileSiswa-Do2u1Iin.js";import{_ as ue}from"./AppSelect-CZ3YcZJq.js";import{_ as de}from"./DefaultForm-C4vmYM89.js";import{$}from"./api-DV11byyd.js";import{V as pe,c as fe,a as _e,b as G}from"./VCard-Av5KF9XZ.js";import{V as I}from"./VDivider-xKTMVaVZ.js";import{V as R,a as g}from"./VRow-BwW1PfoV.js";import{V as be}from"./VFileInput-C5vBK4Ue.js";import{V as ce}from"./VTable-WZOTEkgO.js";import{V as ge}from"./VForm-D50gy_Td.js";import{V as ke}from"./VOverlay-B8TKvbjl.js";import"./VDialog-CMVIV99-.js";import"./forwardRefs-DWGaNmQL.js";import"./scopeId-FMl0qGlW.js";import"./VLabel-BtGXOH7p.js";import"./VImg-BD46ZmSh.js";import"./VField-D2ajgn9J.js";import"./VAvatar-Cnp5qM21.js";import"./VSelect-A1cRPDhv.js";import"./VList-BVPheIBU.js";import"./ssrBoot-SBUkp28z.js";import"./VMenu-BZlhnuPC.js";import"./VSelectionControl-RkTZifSY.js";import"./VChip-BbopsKiC.js";import"./VSlideGroup-BqtQ8Q2P.js";import"./AppAutocomplete-jvNr0OkR.js";import"./filter-6repwXrG.js";import"./index-BxkgbwWS.js";/* empty css              */const ve={key:0,class:"text-center"},Ve=["rowspan"],ye=["rowspan"],xe={style:{"inline-size":"6rem"}},he={style:{"vertical-align":"top"},class:"pt-2"},ia={__name:"nilai-akhir",setup(je){const B=m(""),o=m({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,bentuk_penilaian:null,template_excel:null}),f=m({akhir:{},kompeten:{}}),k=m({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,bentuk_penilaian:null,template_excel:null}),r=m({rombel:[],mapel:[],teknik:[],siswa:[],tp:[]}),s=m({rombel:!1,mapel:!1,bentuk_penilaian:!1,body:!1}),D=m(!1),h=m(!1),C=m(!1),v=m(!1),K=m(""),V=m({color:"",title:"",text:""}),H=async()=>{h.value=!0;const n={...y,...o.value,...f.value};await $("/penilaian/simpan",{method:"POST",body:n,onResponse({response:e}){let p=e._data;h.value=!1,p.errors?k.value=p.errors:(v.value=!0,V.value=p)}})},y={opsi:"nilai-akhir",semester_id:le.semester_id,user_id:E.user_id,guru_id:E.guru_id,sekolah_id:E.sekolah_id,merdeka:!1},F=m(!1),J=()=>{F.value=!0,o.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,bentuk_penilaian:null,template_excel:null},f.value={akhir:{},kompeten:{}},k.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,bentuk_penilaian:null,template_excel:null},r.value={rombel:[],mapel:[],teknik:[],siswa:[],tp:[]},s.value={rombel:!1,mapel:!1,bentuk_penilaian:!1,body:!1},D.value=!1,h.value=!1,C.value=!1,v.value=!1,K.value="",V.value={color:"",title:"",text:""}},A=async n=>{const e={...n,...y};await $("/referensi/get-data",{method:"POST",body:e,onResponse({response:p}){let d=p._data;n.data=="rombel"&&(r.value.rombel=d),n.data=="mapel"&&(r.value.mapel=d.mapel,y.merdeka=d.merdeka),n.data=="teknik"&&(r.value.teknik=d)}})},Q=async n=>{o.value.rombongan_belajar_id=null,o.value.pembelajaran_id=null,o.value.mata_pelajaran_id=null,n&&(s.value.rombel=!0,await A({data:"rombel",nilai:1,tingkat:n}).then(()=>{s.value.rombel=!1}))},W=async n=>{o.value.pembelajaran_id=null,o.value.mata_pelajaran_id=null,n&&(s.value.mapel=!0,await A({data:"mapel",nilai:1,rombongan_belajar_id:n}).then(()=>{s.value.mapel=!1}))},X=async n=>{o.value.bentuk_penilaian=null,n&&(s.value.bentuk_penilaian=!0,await A({data:"teknik"}).then(()=>{s.value.bentuk_penilaian=!1}))},P=m(!1),Y=async n=>{if(r.value.siswa=[],r.value.tp=[],n){const e={...o.value,...y};s.value.body=!0,D.value=!1,await $("/penilaian/get-nilai-akhir",{method:"POST",body:e,onResponse({response:p}){let d=p._data;r.value.siswa=d.data_siswa,r.value.tp=d.data_tp,B.value="",o.value.bentuk_penilaian=="asesmen"?P.value=!0:(P.value=!1,B.value=`/downloads/template-nilai-akhir/${o.value.pembelajaran_id}`),d.data_siswa.forEach(b=>{o.value.bentuk_penilaian=="asesmen"?f.value.akhir[b.anggota_rombel_id]=b.nilai_asesmen:f.value.akhir[b.anggota_rombel_id]=b.nilai_akhir,d.data_tp.forEach(U=>{const j=b.capaian_kompeten.find(t=>t.tp_id===U.tp_id);f.value.kompeten[b.anggota_rombel_id+"#"+U.tp_id]=j==null?void 0:j.kompeten})}),D.value=!0,s.value.body=!1}})}},Z=()=>{J()},x=m(!1),ee=async n=>{x.value=!0;const e=new FormData;e.append("template_excel",n),e.append("rombongan_belajar_id",o.value.rombongan_belajar_id),e.append("pembelajaran_id",o.value.pembelajaran_id),e.append("sekolah_id",y.sekolah_id),e.append("merdeka",y.merdeka),await $("/penilaian/upload-nilai",{method:"POST",body:e,onResponse({response:p}){let d=p._data;v.value=!0,V.value=d,x.value=!1}})};return(n,e)=>{const p=de,d=ue,b=me,U=se,j=re;return _(),N(pe,{class:"mb-6"},{default:i(()=>[l(_e,{class:"pb-4"},{default:i(()=>[l(fe,null,{default:i(()=>e[10]||(e[10]=[O("Input Nilai Akhir")])),_:1})]),_:1}),l(I),l(ge,{onSubmit:ie(H,["prevent"])},{default:i(()=>[l(G,null,{default:i(()=>[l(R,null,{default:i(()=>[l(p,{form:a(o),"onUpdate:form":e[0]||(e[0]=t=>c(o)?o.value=t:null),errors:a(k),"onUpdate:errors":e[1]||(e[1]=t=>c(k)?k.value=t:null),arrayData:a(r),"onUpdate:arrayData":e[2]||(e[2]=t=>c(r)?r.value=t:null),loading:a(s),"onUpdate:loading":e[3]||(e[3]=t=>c(s)?s.value=t:null),resetForm:a(F),"onUpdate:resetForm":e[4]||(e[4]=t=>c(F)?F.value=t:null),onTingkat:Q,onRombongan_belajar_id:W,onPembelajaran_id:X},null,8,["form","errors","arrayData","loading","resetForm"]),l(g,{cols:"12"},{default:i(()=>[l(R,{"no-gutters":""},{default:i(()=>[l(g,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:i(()=>e[11]||(e[11]=[u("label",{class:"v-label text-body-2 text-high-emphasis",for:"bentuk_penilaian"},"Bentuk Penilaian",-1)])),_:1}),l(g,{cols:"12",md:"9"},{default:i(()=>[l(d,{modelValue:a(o).bentuk_penilaian,"onUpdate:modelValue":[e[5]||(e[5]=t=>a(o).bentuk_penilaian=t),Y],placeholder:"== Pilih Bentuk Penilaian ==",items:"bentukPenilaian"in n?n.bentukPenilaian:a(te),clearable:"","clear-icon":"tabler-x","error-messages":a(k).bentuk_penilaian,loading:a(s).bentuk_penilaian,disabled:a(s).bentuk_penilaian},null,8,["modelValue","items","error-messages","loading","disabled"])]),_:1})]),_:1})]),_:1}),a(r).siswa.length&&!a(P)?(_(),N(g,{key:0,cols:"12"},{default:i(()=>[l(R,{"no-gutters":""},{default:i(()=>[l(g,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:i(()=>e[12]||(e[12]=[u("label",{class:"v-label text-body-2 text-high-emphasis",for:"template_excel"},"Template Excel",-1)])),_:1}),l(g,{cols:"12",md:"9"},{default:i(()=>[l(R,{"no-gutters":""},{default:i(()=>[l(g,{cols:"6"},{default:i(()=>[l(be,{id:"template_excel",modelValue:a(o).template_excel,"onUpdate:modelValue":[e[6]||(e[6]=t=>a(o).template_excel=t),ee],"error-messages":a(k).template_excel,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",label:"Unggah Template Excel"},null,8,["modelValue","error-messages"])]),_:1}),l(g,{cols:"6"},{default:i(()=>[l(M,{color:"primary",class:"ms-3",href:a(B),target:"_blank"},{default:i(()=>e[13]||(e[13]=[O(" Unduh Template Nilai Akhir ")])),_:1},8,["href"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1}),a(s).body?(_(),T("div",ve,[l(q,{size:60,indeterminate:"",color:"error",class:"my-10"})])):S("",!0)]),_:1}),l(I),a(r).siswa.length&&!a(x)?(_(),N(ce,{key:0},{default:i(()=>[e[14]||(e[14]=u("thead",null,[u("tr",null,[u("th",{class:"text-center"},"Nama Peserta Didik"),u("th",{class:"text-center"},"Nilai Akhir"),u("th",{class:"text-center"},"Ketercapaian Kompetensi"),u("th",null,"Deskripsi Tujuan Pembelajaran")])],-1)),u("tbody",null,[(_(!0),T(z,null,L(a(r).siswa,t=>(_(),T(z,null,[u("tr",null,[u("td",{rowspan:a(r).tp.length+1,class:"text-no-wrap pt-2",style:{"vertical-align":"top"}},[l(b,{item:t},null,8,["item"])],8,Ve),u("td",{rowspan:a(r).tp.length+1,style:{"vertical-align":"top"},class:"pt-2"},[u("div",xe,[l(U,{type:"number",modelValue:a(f).akhir[t.anggota_rombel_id],"onUpdate:modelValue":w=>a(f).akhir[t.anggota_rombel_id]=w,disabled:a(P)},null,8,["modelValue","onUpdate:modelValue","disabled"])])],8,ye)]),(_(!0),T(z,null,L(a(r).tp,(w,we)=>(_(),T("tr",null,[u("td",he,[l(d,{modelValue:a(f).kompeten[t.anggota_rombel_id+"#"+w.tp_id],"onUpdate:modelValue":ae=>a(f).kompeten[t.anggota_rombel_id+"#"+w.tp_id]=ae,placeholder:"== Pilih Capaian ==",items:"dataCapaian"in n?n.dataCapaian:a(ne),clearable:"","clear-icon":"tabler-x",style:{"inline-size":"12rem"}},null,8,["modelValue","onUpdate:modelValue","items"])]),u("td",null,oe(w.deskripsi),1)]))),256))],64))),256))])]),_:1})):S("",!0),l(I),a(D)?(_(),N(G,{key:1,class:"d-flex justify-end flex-wrap gap-3 pt-5 overflow-visible"},{default:i(()=>[l(M,{variant:"elevated",type:"submit",loading:a(h),disabled:a(h)},{default:i(()=>e[15]||(e[15]=[O(" Simpan ")])),_:1},8,["loading","disabled"])]),_:1})):S("",!0)]),_:1}),l(j,{isDialogVisible:a(C),"onUpdate:isDialogVisible":e[7]||(e[7]=t=>c(C)?C.value=t:null),isNotifVisible:a(v),"onUpdate:isNotifVisible":e[8]||(e[8]=t=>c(v)?v.value=t:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":a(K),"confirm-color":a(V).color,"confirm-title":a(V).title,"confirm-msg":a(V).text,onClose:Z},null,8,["isDialogVisible","isNotifVisible","confirmation-text","confirm-color","confirm-title","confirm-msg"]),l(ke,{modelValue:a(x),"onUpdate:modelValue":e[9]||(e[9]=t=>c(x)?x.value=t:null),contained:"",persistent:"","scroll-strategy":"none",class:"align-center justify-center"},{default:i(()=>[l(q,{indeterminate:""})]),_:1},8,["modelValue"])]),_:1})}}};export{ia as default};
