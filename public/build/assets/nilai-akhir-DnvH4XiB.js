import{a as le,d as O,e as te,f as ne}from"./mixins-Cm_caD4z.js";import{r as m,f as D,e as n,o as f,b as l,t as $,m as a,a2 as c,d as u,aa as q,y as C,c as P,am as L,h as G,F as z,ap as ie,v as oe}from"./main-D8C-6_X1.js";import{_ as re}from"./ConfirmDialog-CWwtyCJn.js";import{_ as se}from"./AppTextField-BMCEspbF.js";import{_ as me}from"./ProfileSiswa-Bh3dq5Lo.js";import{_ as ue}from"./AppSelect-B4iKUcaM.js";import{_ as de}from"./DefaultForm-5hjsCUg3.js";import{$ as B}from"./api-Bv3Txjvc.js";import{V as pe,c as fe,a as _e,b as I}from"./VCard-BBWo_BJX.js";import{V as K}from"./VDivider-Dpy3YLCE.js";import{V as R,a as g}from"./VRow-DagOCQt8.js";import{V as be}from"./VFileInput-C-qgxH50.js";import{V as ce}from"./VTable-DLA_Q_a3.js";import{V as ge}from"./VAlert-k3tA-dv9.js";import{V as ke}from"./VForm-mjA0_ArF.js";import{V as ve}from"./VOverlay-C9Rn8Hcw.js";import"./VDialog-BsRtSOok.js";import"./forwardRefs-DWGaNmQL.js";import"./scopeId-BWtDf27Y.js";import"./VLabel-BHKnca0s.js";import"./VImg-DqT38yV8.js";/* empty css                   */import"./VField-Cfw2AAFT.js";import"./VAvatar-JaoB6U7x.js";import"./VSelect-BmHuZV-7.js";import"./VList-B1dy6__A.js";import"./ssrBoot-dmfLNbw9.js";import"./VMenu-BbC-IeQF.js";import"./VSelectionControl-B0ofD5x7.js";import"./VChip--zMAKmD8.js";import"./VSlideGroup-B6WoVzAQ.js";import"./AppAutocomplete-OncM1NSS.js";import"./filter-Cm1Q39Un.js";import"./index-BxkgbwWS.js";/* empty css              */const Ve={key:0,class:"text-center"},ye=["rowspan"],xe=["rowspan"],he={style:{"inline-size":"6rem"}},je={style:{"vertical-align":"top"},class:"pt-2"},sa={__name:"nilai-akhir",setup(we){const A=m(""),o=m({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,bentuk_penilaian:null,template_excel:null}),_=m({akhir:{},kompeten:{}}),k=m({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,bentuk_penilaian:null,template_excel:null}),r=m({rombel:[],mapel:[],teknik:[],siswa:[],tp:[]}),s=m({rombel:!1,mapel:!1,bentuk_penilaian:!1,body:!1}),h=m(!1),j=m(!1),F=m(!1),v=m(!1),M=m(""),V=m({color:"",title:"",text:""}),H=async()=>{j.value=!0;const i={...y,...o.value,..._.value};await B("/penilaian/simpan",{method:"POST",body:i,onResponse({response:e}){let p=e._data;j.value=!1,p.errors?k.value=p.errors:(v.value=!0,V.value=p)}})},y={opsi:"nilai-akhir",semester_id:le.semester_id,user_id:O.user_id,guru_id:O.guru_id,sekolah_id:O.sekolah_id,merdeka:!1},U=m(!1),J=()=>{U.value=!0,o.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,bentuk_penilaian:null,template_excel:null},_.value={akhir:{},kompeten:{}},k.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,bentuk_penilaian:null,template_excel:null},r.value={rombel:[],mapel:[],teknik:[],siswa:[],tp:[]},s.value={rombel:!1,mapel:!1,bentuk_penilaian:!1,body:!1},h.value=!1,j.value=!1,F.value=!1,v.value=!1,M.value="",V.value={color:"",title:"",text:""}},E=async i=>{const e={...i,...y};await B("/referensi/get-data",{method:"POST",body:e,onResponse({response:p}){let d=p._data;i.data=="rombel"&&(r.value.rombel=d),i.data=="mapel"&&(r.value.mapel=d.mapel,y.merdeka=d.merdeka),i.data=="teknik"&&(r.value.teknik=d)}})},Q=async i=>{o.value.rombongan_belajar_id=null,o.value.pembelajaran_id=null,o.value.mata_pelajaran_id=null,i&&(s.value.rombel=!0,await E({data:"rombel",nilai:1,tingkat:i}).then(()=>{s.value.rombel=!1}))},W=async i=>{o.value.pembelajaran_id=null,o.value.mata_pelajaran_id=null,i&&(s.value.mapel=!0,await E({data:"mapel",nilai:1,rombongan_belajar_id:i}).then(()=>{s.value.mapel=!1}))},X=async i=>{o.value.bentuk_penilaian=null,i&&(s.value.bentuk_penilaian=!0,await E({data:"teknik"}).then(()=>{s.value.bentuk_penilaian=!1}))},N=m(!1),Y=async i=>{if(r.value.siswa=[],r.value.tp=[],i){const e={...o.value,...y};s.value.body=!0,h.value=!1,await B("/penilaian/get-nilai-akhir",{method:"POST",body:e,onResponse({response:p}){let d=p._data;r.value.siswa=d.data_siswa,r.value.tp=d.data_tp,A.value="",o.value.bentuk_penilaian=="asesmen"?N.value=!0:(N.value=!1,A.value=`/downloads/template-nilai-akhir/${o.value.pembelajaran_id}`),d.data_siswa.forEach(b=>{o.value.bentuk_penilaian=="asesmen"?_.value.akhir[b.anggota_rombel_id]=b.nilai_asesmen:_.value.akhir[b.anggota_rombel_id]=b.nilai_akhir,d.data_tp.forEach(S=>{const w=b.capaian_kompeten.find(t=>t.tp_id===S.tp_id);_.value.kompeten[b.anggota_rombel_id+"#"+S.tp_id]=w==null?void 0:w.kompeten})}),h.value=!0,s.value.body=!1}})}},Z=()=>{J()},x=m(!1),ee=async i=>{x.value=!0;const e=new FormData;e.append("template_excel",i),e.append("rombongan_belajar_id",o.value.rombongan_belajar_id),e.append("pembelajaran_id",o.value.pembelajaran_id),e.append("sekolah_id",y.sekolah_id),e.append("merdeka",y.merdeka),await B("/penilaian/upload-nilai",{method:"POST",body:e,onResponse({response:p}){let d=p._data;v.value=!0,V.value=d,x.value=!1}})};return(i,e)=>{const p=de,d=ue,b=me,S=se,w=re;return f(),D(pe,{class:"mb-6"},{default:n(()=>[l(_e,{class:"pb-4"},{default:n(()=>[l(fe,null,{default:n(()=>e[10]||(e[10]=[$("Input Nilai Akhir")])),_:1})]),_:1}),l(K),l(ke,{onSubmit:ie(H,["prevent"])},{default:n(()=>[l(I,null,{default:n(()=>[l(R,null,{default:n(()=>[l(p,{form:a(o),"onUpdate:form":e[0]||(e[0]=t=>c(o)?o.value=t:null),errors:a(k),"onUpdate:errors":e[1]||(e[1]=t=>c(k)?k.value=t:null),arrayData:a(r),"onUpdate:arrayData":e[2]||(e[2]=t=>c(r)?r.value=t:null),loading:a(s),"onUpdate:loading":e[3]||(e[3]=t=>c(s)?s.value=t:null),resetForm:a(U),"onUpdate:resetForm":e[4]||(e[4]=t=>c(U)?U.value=t:null),onTingkat:Q,onRombongan_belajar_id:W,onPembelajaran_id:X},null,8,["form","errors","arrayData","loading","resetForm"]),l(g,{cols:"12"},{default:n(()=>[l(R,{"no-gutters":""},{default:n(()=>[l(g,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:n(()=>e[11]||(e[11]=[u("label",{class:"v-label text-body-2 text-high-emphasis",for:"bentuk_penilaian"},"Bentuk Penilaian",-1)])),_:1}),l(g,{cols:"12",md:"9"},{default:n(()=>[l(d,{modelValue:a(o).bentuk_penilaian,"onUpdate:modelValue":[e[5]||(e[5]=t=>a(o).bentuk_penilaian=t),Y],placeholder:"== Pilih Bentuk Penilaian ==",items:"bentukPenilaian"in i?i.bentukPenilaian:a(te),clearable:"","clear-icon":"tabler-x","error-messages":a(k).bentuk_penilaian,loading:a(s).bentuk_penilaian,disabled:a(s).bentuk_penilaian},null,8,["modelValue","items","error-messages","loading","disabled"])]),_:1})]),_:1})]),_:1}),a(r).siswa.length&&a(r).tp.length&&!a(N)?(f(),D(g,{key:0,cols:"12"},{default:n(()=>[l(R,{"no-gutters":""},{default:n(()=>[l(g,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:n(()=>e[12]||(e[12]=[u("label",{class:"v-label text-body-2 text-high-emphasis",for:"template_excel"},"Template Excel",-1)])),_:1}),l(g,{cols:"12",md:"9"},{default:n(()=>[l(R,{"no-gutters":""},{default:n(()=>[l(g,{cols:"6"},{default:n(()=>[l(be,{id:"template_excel",modelValue:a(o).template_excel,"onUpdate:modelValue":[e[6]||(e[6]=t=>a(o).template_excel=t),ee],"error-messages":a(k).template_excel,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",label:"Unggah Template Excel"},null,8,["modelValue","error-messages"])]),_:1}),l(g,{cols:"6"},{default:n(()=>[l(q,{color:"primary",class:"ms-3",href:a(A),target:"_blank"},{default:n(()=>e[13]||(e[13]=[$(" Unduh Template Nilai Akhir ")])),_:1},8,["href"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):C("",!0)]),_:1}),a(s).body?(f(),P("div",Ve,[l(L,{size:60,indeterminate:"",color:"error",class:"my-10"})])):C("",!0)]),_:1}),l(K),a(r).siswa.length&&a(r).tp.length&&!a(x)?(f(),D(ce,{key:0},{default:n(()=>[e[14]||(e[14]=u("thead",null,[u("tr",null,[u("th",{class:"text-center"},"Nama Peserta Didik"),u("th",{class:"text-center"},"Nilai Akhir"),u("th",{class:"text-center"},"Ketercapaian Kompetensi"),u("th",null,"Deskripsi Tujuan Pembelajaran")])],-1)),u("tbody",null,[(f(!0),P(z,null,G(a(r).siswa,t=>(f(),P(z,null,[u("tr",null,[u("td",{rowspan:a(r).tp.length+1,class:"text-no-wrap pt-2",style:{"vertical-align":"top"}},[l(b,{item:t},null,8,["item"])],8,ye),u("td",{rowspan:a(r).tp.length+1,style:{"vertical-align":"top"},class:"pt-2"},[u("div",he,[l(S,{type:"number",modelValue:a(_).akhir[t.anggota_rombel_id],"onUpdate:modelValue":T=>a(_).akhir[t.anggota_rombel_id]=T,disabled:a(N)},null,8,["modelValue","onUpdate:modelValue","disabled"])])],8,xe)]),(f(!0),P(z,null,G(a(r).tp,(T,Te)=>(f(),P("tr",null,[u("td",je,[l(d,{modelValue:a(_).kompeten[t.anggota_rombel_id+"#"+T.tp_id],"onUpdate:modelValue":ae=>a(_).kompeten[t.anggota_rombel_id+"#"+T.tp_id]=ae,placeholder:"== Pilih Capaian ==",items:"dataCapaian"in i?i.dataCapaian:a(ne),clearable:"","clear-icon":"tabler-x",style:{"inline-size":"12rem"}},null,8,["modelValue","onUpdate:modelValue","items"])]),u("td",null,oe(T.deskripsi),1)]))),256))],64))),256))])]),_:1})):C("",!0),l(K),a(h)&&a(r).tp.length?(f(),D(I,{key:1,class:"d-flex justify-end flex-wrap gap-3 pt-5 overflow-visible"},{default:n(()=>[l(q,{variant:"elevated",type:"submit",loading:a(j),disabled:a(j)},{default:n(()=>e[15]||(e[15]=[$(" Simpan ")])),_:1},8,["loading","disabled"])]),_:1})):C("",!0),a(h)&&!a(r).tp.length?(f(),D(I,{key:2,class:"d-flex justify-end flex-wrap gap-3 pt-5 overflow-visible"},{default:n(()=>[l(ge,{color:"error"},{default:n(()=>e[16]||(e[16]=[$("Belum ada TP untuk mata pelajaran ini.")])),_:1})]),_:1})):C("",!0)]),_:1}),l(w,{isDialogVisible:a(F),"onUpdate:isDialogVisible":e[7]||(e[7]=t=>c(F)?F.value=t:null),isNotifVisible:a(v),"onUpdate:isNotifVisible":e[8]||(e[8]=t=>c(v)?v.value=t:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":a(M),"confirm-color":a(V).color,"confirm-title":a(V).title,"confirm-msg":a(V).text,onClose:Z},null,8,["isDialogVisible","isNotifVisible","confirmation-text","confirm-color","confirm-title","confirm-msg"]),l(ve,{modelValue:a(x),"onUpdate:modelValue":e[9]||(e[9]=t=>c(x)?x.value=t:null),contained:"",persistent:"","scroll-strategy":"none",class:"align-center justify-center"},{default:n(()=>[l(L,{indeterminate:""})]),_:1},8,["modelValue"])]),_:1})}}};export{sa as default};
