import{a as x,d as Y}from"./mixins-Do01Tvpi.js";import{_ as xe}from"./AlertDialog-DXxzERa3.js";import{_ as we}from"./ConfirmDialog-DEtJ9YHf.js";import{_ as Pe}from"./DialogCloseBtn-DDowJWAj.js";import{_ as Ce}from"./TablePagination-tXgFpqyX.js";import{_ as De}from"./AppTextField-BO6w-NjC.js";import{_ as $e}from"./AppSelect-B2PHoo-x.js";import{b as Ae}from"./index-NOZ-zHIz.js";import{u as Te,c as Re}from"./createUrl-BXcv10L8.js";import{$ as z}from"./api-CbnF2F_N.js";import{V as E,a as Z,c as ee,b as w}from"./VCard-DkQKJDRB.js";import{V as le}from"./VDialog-BIu7mksy.js";import{V as I}from"./VDivider-Dhg7eMF0.js";import{V as ae}from"./VSpacer-D8Y2KROC.js";import{r as i,G as Ue,w as te,c as P,b as t,e as o,m as l,a2 as C,o as g,t as f,d as s,aa as k,v as c,F as L,f as D,h as se,y as J}from"./main-BpzOKNoA.js";import{V as Se}from"./VDataTableServer-Dpmy7Q46.js";import{V as Be}from"./VAvatar-Ddpywjbl.js";import{V as Ne}from"./VImg-BbE4AfBU.js";import{V as oe}from"./VChip-DVAuZVH0.js";import{V as ne}from"./VTable-DuVTcngC.js";import{V as ze}from"./VCheckbox-J6a3qD8G.js";import"./VLabel-DSCxQ7R6.js";import"./VField-ColkkmFo.js";import"./forwardRefs-DWGaNmQL.js";import"./VSelect-BAXzc1tN.js";import"./VList-CxLNrE2t.js";import"./ssrBoot-CeJZM__3.js";import"./VOverlay-CaqnmWII.js";import"./scopeId-D8AFld2n.js";import"./VMenu-BjIWR5X6.js";import"./VSelectionControl-C62c-rz1.js";import"./index-BxkgbwWS.js";/* empty css              */import"./filter-D7lmOnkH.js";import"./VSlideGroup-Bx8gxucL.js";const Ie={class:"me-3 d-flex gap-3"},Le={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},qe={style:{"inline-size":"15.625rem"}},he={class:"d-flex align-center gap-x-4"},je={class:"d-flex flex-column"},He={class:"text-base"},Qe={class:"text-sm"},Fe={class:"text-center"},$l={__name:"pengguna",setup(Oe){const r=i({page:1,itemsPerPage:10,searchQuery:"",selectedRole:null,sortby:"name",sortbydesc:"ASC"}),ie=[{title:"Pengguna",key:"name",nowrap:!0},{title:"Jenis Pengguna",key:"roles",sortable:!1},{title:"Terakhir Login",key:"login_terakhir",sortable:!1},{title:"password",key:"password",sortable:!1},{title:"Aksi",key:"actions",align:"center",sortable:!1,nowrap:!0}],q=i([]),U=i(0),b=i([]),h=i(!1);Ue(async()=>{await j()}),te(r,async()=>{await j()},{deep:!0}),te(()=>r.value.searchQuery,()=>{r.value.page=1});const re=n=>{var e,u;r.value.sortby=(e=n[0])==null?void 0:e.key,r.value.sortbydesc=(u=n[0])==null?void 0:u.order},j=async()=>{h.value=!0,q.value=[],U.value=[],b.value=[];try{let e=(await Te(Re("/setting/users",{query:{q:r.value.searchQuery,page:r.value.page,per_page:r.value.itemsPerPage,periode_aktif:x.nama,sekolah_id:Y.sekolah_id,role_id:r.value.selectedRole,sortby:r.value.sortby,sortbydesc:r.value.sortbydesc}}))).data;q.value=e.value.data.data,U.value=e.value.data.total,b.value=e.value.roles}catch(n){console.error(n)}finally{h.value=!1}},$=i([]),ue=n=>{var e=n.map(u=>u.display_name);return e.join(", ")},H=(n,e)=>e?Ae.compareSync(e,n):!1,y=i(!1),V=i(!1),de=async()=>{V.value=!0},K=async n=>{y.value=!0,await z("/setting/generate-pengguna",{method:"POST",body:{aksi:n,semester_id:x.semester_id,sekolah_id:Y.sekolah_id,periode_aktif:x.nama},onResponse({request:e,response:u,options:v}){let m=u._data;y.value=!1,V.value=!1,p.value.color=m.color,p.value.title=m.title,p.value.text=m.text,R.value=!0}})},S=i([]),_=i(!1),A=i(!1),T=i(!1),M=i(),d=i({userId:null,nama:null,email:null,password:null,defaultPassword:null,lastLogin:null}),W=i([]),Q=i([]),X=async n=>{S.value[n]=!0,await z("/setting/detil-user",{method:"POST",body:{user_id:n,periode_aktif:x.nama},onResponse({request:e,response:u,options:v}){let m=u._data;S.value[n]=!1,M.value=`Detil ${m.user.name}`,d.value.userId=m.user.user_id,d.value.nama=m.user.name,d.value.email=m.user.email,d.value.password=m.user.password,d.value.defaultPassword=m.user.default_password,d.value.lastLogin=m.user.login_terakhir,Q.value=m.roles,_.value=!0,W.value=m.permission}})},F=(n,e)=>{let u=n.filter(v=>v.id===e);return u.length?u[0].display_name:"-"},me=(n,e)=>{let u=n.filter(v=>v.id===e);return u.length?u[0].name:"-"},B=i([]),O=i();i({user_id:null,role:null,periode_aktif:null});const G=i({aksi:null,user_id:null,role:null,periode_aktif:null}),pe=()=>{A.value=!0,G.value={aksi:"reset-password",user_id:d.value.userId,role:null,periode_aktif:null}},fe=(n,e)=>{O.value=`${n}-${e}`,B.value[O.value]=!0,A.value=!0,G.value={aksi:"hapus-akses",user_id:d.value.userId,role:n,periode_aktif:e}},p=i({color:null,title:null,text:null}),ve=[7,8,9],ge=async n=>{n&&await z("/setting/update-user",{method:"POST",body:G.value,onResponse({request:e,response:u,options:v}){let m=u._data;p.value=m,T.value=!0}}),B.value[O.value]=!1},R=i(!1),ce=async()=>{await z("/setting/update-akses",{method:"POST",body:{user_id:d.value.userId,akses:$.value,periode_aktif:x.nama},onResponse({request:n,response:e,options:u}){let v=e._data;p.value.color=v.color,p.value.title=v.title,p.value.text=v.text,R.value=!0}})},ke=()=>{_.value=!1,$.value=[],T.value=!1,setTimeout(()=>{p.value={color:"",title:"",text:""}},300),j()},ye=async()=>{await X(d.value.userId)};return(n,e)=>{const u=$e,v=De,m=Ce,be=Pe,_e=we,Ve=xe;return g(),P("section",null,[t(E,{class:"mb-6"},{default:o(()=>[t(Z,{class:"pb-4"},{default:o(()=>[t(ee,null,{default:o(()=>e[14]||(e[14]=[f("Akses Pengguna")])),_:1})]),_:1}),t(I),t(w,{class:"d-flex flex-wrap gap-4"},{default:o(()=>[s("div",Ie,[t(u,{modelValue:l(r).itemsPerPage,"onUpdate:modelValue":e[0]||(e[0]=a=>l(r).itemsPerPage=a),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}],style:{"inline-size":"6.25rem"}},null,8,["modelValue"])]),t(ae),s("div",Le,[s("div",qe,[t(v,{modelValue:l(r).searchQuery,"onUpdate:modelValue":e[1]||(e[1]=a=>l(r).searchQuery=a),placeholder:"Cari Data"},null,8,["modelValue"])]),t(u,{modelValue:l(r).selectedRole,"onUpdate:modelValue":e[2]||(e[2]=a=>l(r).selectedRole=a),placeholder:"Filter Hak Akses",items:l(b),clearable:"","clear-icon":"tabler-x",style:{"inline-size":"15rem"},"item-title":"display_name","item-value":"name"},null,8,["modelValue","items"]),t(k,{"prepend-icon":"tabler-bolt",onClick:de},{default:o(()=>e[15]||(e[15]=[f(" Atur Ulang ")])),_:1})])]),_:1}),t(I),t(Se,{items:l(q),"server-items-length":l(U),headers:ie,options:l(r),loading:l(h),"loading-text":"Loading...","onUpdate:sortBy":re},{"item.name":o(({item:a})=>[s("div",he,[t(Be,{size:"34",variant:a.profile_photo_path?void 0:"tonal",color:a.profile_photo_path?void 0:"success"},{default:o(()=>[t(Ne,{src:a.profile_photo_path},null,8,["src"])]),_:2},1032,["variant","color"]),s("div",je,[s("h6",He,c(a.name),1),s("div",Qe,c(a.email),1)])])]),"item.roles":o(({item:a})=>[f(c(ue(a.roles)),1)]),"item.password":o(({item:a})=>[H(a.password,a.default_password)?(g(),P(L,{key:0},[f(c(a.default_password),1)],64)):(g(),D(oe,{key:1,size:"x-small",color:"error"},{default:o(()=>e[16]||(e[16]=[f(" Custom ")])),_:1}))]),"item.actions":o(({item:a})=>[t(k,{loading:l(S)[a.user_id],disabled:l(S)[a.user_id],color:"warning",icon:"tabler-eye",onClick:N=>X(a.user_id)},null,8,["loading","disabled","onClick"])]),bottom:o(()=>[t(m,{page:l(r).page,"onUpdate:page":e[3]||(e[3]=a=>l(r).page=a),"items-per-page":l(r).itemsPerPage,"total-items":l(U)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items","server-items-length","options","loading"])]),_:1}),t(le,{modelValue:l(_),"onUpdate:modelValue":e[6]||(e[6]=a=>C(_)?_.value=a:null),width:"800"},{default:o(()=>[t(be,{onClick:e[4]||(e[4]=a=>_.value=!l(_))}),t(E,{style:{position:"relative"}},{default:o(()=>[t(Z,{class:"pb-5"},{default:o(()=>[t(ee,null,{default:o(()=>[f(c(l(M)),1)]),_:1})]),_:1}),t(I),t(ne,{class:"text-no-wrap"},{default:o(()=>[s("tbody",null,[s("tr",null,[e[17]||(e[17]=s("td",null,"Nama",-1)),s("td",null,c(l(d).nama),1)]),s("tr",null,[e[18]||(e[18]=s("td",null,"Email",-1)),s("td",null,c(l(d).email),1)]),s("tr",null,[e[20]||(e[20]=s("td",null,"Password",-1)),s("td",null,[H(l(d).password,l(d).defaultPassword)?(g(),P(L,{key:0},[f(c(l(d).defaultPassword),1)],64)):(g(),D(oe,{key:1,size:"x-small",color:"error"},{default:o(()=>e[19]||(e[19]=[f(" Custom ")])),_:1}))])]),s("tr",null,[e[21]||(e[21]=s("td",null,"Terakhir Login",-1)),s("td",null,c(l(d).lastLogin),1)])])]),_:1}),t(w,null,{default:o(()=>e[22]||(e[22]=[s("h4",null,"Hak Akses yang Dimiliki",-1)])),_:1}),t(ne,{class:"text-no-wrap"},{default:o(()=>[e[23]||(e[23]=s("thead",null,[s("tr",null,[s("th",null,"Tahun Pelajaran"),s("th",null,"Hak Akses"),s("th",{class:"text-center"},"Aksi")])],-1)),s("tbody",null,[(g(!0),P(L,null,se(l(W),(a,N)=>(g(),P("tr",{key:N},[s("td",null,c(a.name),1),s("td",null,c(F(l(b),a.pivot.role_id)),1),s("td",Fe,[ve.includes(a.pivot.role_id)?(g(),D(k,{key:0,loading:l(B)[`${F(l(b),a.pivot.role_id)}-${a.name}`],disabled:l(B)[`${F(l(b),a.pivot.role_id)}-${a.name}`],color:"error",icon:"tabler-trash",onClick:Ge=>fe(me(l(b),a.pivot.role_id),a.name)},null,8,["loading","disabled","onClick"])):J("",!0)])]))),128))])]),_:1}),l(Q).length?(g(),D(w,{key:0},{default:o(()=>[s("h4",null,"Tambah Hak Akses di Tahun Pelajaran "+c(("$semester"in n?n.$semester:l(x)).nama),1),(g(!0),P(L,null,se(l(Q),a=>(g(),D(ze,{key:a,modelValue:l($),"onUpdate:modelValue":e[5]||(e[5]=N=>C($)?$.value=N:null),label:a.text,value:a.value},null,8,["modelValue","label","value"]))),128))]),_:1})):J("",!0),t(I),t(w,{class:"d-flex justify-end flex-wrap gap-3"},{default:o(()=>[H(l(d).password,l(d).defaultPassword)?J("",!0):(g(),D(k,{key:0,color:"error",onClick:pe},{default:o(()=>e[24]||(e[24]=[f(" Reset Password ")])),_:1})),t(ae),t(k,{onClick:ce},{default:o(()=>e[25]||(e[25]=[f(" Simpan ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(_e,{isDialogVisible:l(A),"onUpdate:isDialogVisible":e[7]||(e[7]=a=>C(A)?A.value=a:null),isNotifVisible:l(T),"onUpdate:isNotifVisible":e[8]||(e[8]=a=>C(T)?T.value=a:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":"Tindakan ini tidak dapat dikembalikan!","confirm-color":l(p).color,"confirm-title":l(p).title,"confirm-msg":l(p).text,onConfirm:ge,onClose:ye},null,8,["isDialogVisible","isNotifVisible","confirm-color","confirm-title","confirm-msg"]),t(Ve,{isDialogVisible:l(R),"onUpdate:isDialogVisible":e[9]||(e[9]=a=>C(R)?R.value=a:null),"confirm-color":l(p).color,"confirm-title":l(p).title,"confirm-msg":l(p).text,onConfirm:ke},null,8,["isDialogVisible","confirm-color","confirm-title","confirm-msg"]),t(le,{"max-width":"500",modelValue:l(V),"onUpdate:modelValue":e[13]||(e[13]=a=>C(V)?V.value=a:null)},{default:o(()=>[t(E,{class:"text-center px-10 py-6"},{default:o(()=>[t(w,null,{default:o(()=>[t(k,{icon:"",variant:"outlined",color:"warning",class:"my-4",style:{"block-size":"88px","inline-size":"88px","pointer-events":"none"}},{default:o(()=>e[26]||(e[26]=[s("span",{class:"text-5xl"},"!",-1)])),_:1}),e[27]||(e[27]=s("h6",{class:"text-lg font-weight-medium"}," Generate Pengguna ",-1)),e[28]||(e[28]=s("p",null,"Silahkan Pilih Jenis Akun",-1))]),_:1}),t(w,{class:"d-flex align-center justify-center gap-2"},{default:o(()=>[t(k,{variant:"elevated",color:"primary",onClick:e[10]||(e[10]=a=>K("ptk")),loading:l(y),disabled:l(y)},{default:o(()=>e[29]||(e[29]=[f(" Akun PTK ")])),_:1},8,["loading","disabled"]),t(k,{variant:"elevated",color:"error",onClick:e[11]||(e[11]=a=>K("pd")),loading:l(y),disabled:l(y)},{default:o(()=>e[30]||(e[30]=[f(" Akun PD ")])),_:1},8,["loading","disabled"]),t(k,{color:"secondary",variant:"tonal",onClick:e[12]||(e[12]=a=>V.value=!1),loading:l(y),disabled:l(y)},{default:o(()=>e[31]||(e[31]=[f(" Batal ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{$l as default};
