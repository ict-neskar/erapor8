import{_ as ue}from"./ConfirmDialog-08WhPDIW.js";import{_ as de}from"./AppTextField-5FBXgyoS.js";import{_ as pe}from"./ProfileSiswa-BsnphuhC.js";import{_ as _e}from"./AppSelect-CJR4JKz4.js";import{_ as fe}from"./DefaultForm-BpQqdSMT.js";import{r as p,f as F,e as o,a as ge,o as g,b as t,t as T,m as a,a2 as c,d as _,aa as X,v as M,y as S,c as k,am as Y,h as z,F as C,ap as be}from"./main-C3sapBSz.js";import{$ as R}from"./api-cKcsNrGa.js";import{a as ve,d as J}from"./mixins-RGhIXACJ.js";import{V as ce,c as ke,a as Ve,b as Z}from"./VCard-D_lTQokD.js";import{V as L}from"./VDivider-CVqQjHI4.js";import{V as B,a as V}from"./VRow-Bxui0UIi.js";import{V as ye}from"./VFileInput-Bt7fOhyR.js";import{V as xe}from"./VAlert-Cfmm4B8t.js";import{V as je}from"./VTable-BCYREMx6.js";import{V as Te}from"./VForm-BDqv7H4F.js";import{V as he}from"./VOverlay-D8CESORm.js";import{V as Ue}from"./VTooltip-nWVFCeQf.js";import"./VDialog-DsNVV9VZ.js";import"./forwardRefs-DWGaNmQL.js";import"./scopeId-BWav40DR.js";import"./VLabel-BoDcd68p.js";import"./VImg-BMjvK6WQ.js";/* empty css                   */import"./VField-DMGA2emL.js";import"./VAvatar-BdK8wC9P.js";import"./VSelect-kJg0Kcsb.js";import"./VList-CnXl5Ste.js";import"./ssrBoot-BE7yGWEF.js";import"./VMenu-IW7ayEFB.js";import"./VSelectionControl-CUiD9u5E.js";import"./VChip-C7bzxhaf.js";import"./VSlideGroup-CL7KHkCg.js";import"./AppAutocomplete-eFrO9XcG.js";import"./filter-D3h6iiDO.js";import"./index-BxkgbwWS.js";/* empty css              */const we={key:0,class:"text-center"},$e={class:"text-center"},De={style:{"inline-size":"4rem"}},fa={__name:"asesmen-sumatif",setup(Fe){const I=p(""),q=p(""),s=p({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,teknik_penilaian_id:null,template_excel:null}),u=p({tp:{},sumatif:{}}),y=p({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,teknik_penilaian_id:null,template_excel:null}),d=p({rombel:[],mapel:[],teknik:[],siswa:[],tp:[]}),f=p({rombel:!1,mapel:!1,teknik_penilaian_id:!1,body:!1}),A=p(!1),U=p(!1),P=p(!1),w=p(!1),W=p(""),$=p({color:"",title:"",text:""}),ee=async()=>{U.value=!0;const i={...b,...s.value,...u.value};await R("/penilaian/simpan",{method:"POST",body:i,onResponse({response:e}){let m=e._data;U.value=!1,m.errors?y.value=m.errors:(w.value=!0,$.value=m)}})},b={opsi:"",semester_id:ve.semester_id,user_id:J.user_id,guru_id:J.guru_id,sekolah_id:J.sekolah_id,merdeka:!1},N=p(!1),ae=()=>{N.value=!0,s.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,teknik_penilaian_id:null,template_excel:null},u.value={tp:{},sumatif:{}},y.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,teknik_penilaian_id:null,template_excel:null},d.value={rombel:[],mapel:[],teknik:[],siswa:[],tp:[]},f.value={rombel:!1,mapel:!1,teknik_penilaian_id:!1,body:!1},A.value=!1,U.value=!1,P.value=!1,w.value=!1,W.value="",$.value={color:"",title:"",text:""},b.opsi=""},D=p(!1),O=async i=>{const e={...i,...b};await R("/referensi/get-data",{method:"POST",body:e,onResponse({response:m}){let r=m._data;i.data=="rombel"&&(d.value.rombel=r),i.data=="mapel"&&(d.value.mapel=r.mapel,b.merdeka=r.merdeka,D.value=!!r.rombel.kunci_nilai),i.data=="teknik"&&(d.value.teknik=r)}})},le=async i=>{s.value.rombongan_belajar_id=null,s.value.pembelajaran_id=null,s.value.mata_pelajaran_id=null,i&&(f.value.rombel=!0,await O({data:"rombel",nilai:1,tingkat:i}).then(()=>{f.value.rombel=!1}))},te=async i=>{s.value.pembelajaran_id=null,s.value.mata_pelajaran_id=null,i&&(f.value.mapel=!0,await O({data:"mapel",nilai:1,rombongan_belajar_id:i}).then(()=>{f.value.mapel=!1}))},ne=async i=>{s.value.teknik_penilaian_id=null,i&&(f.value.teknik_penilaian_id=!0,await O({data:"teknik"}).then(()=>{f.value.teknik_penilaian_id=!1}))},K=p(!1),E=p(!1),ie=async i=>{d.value.siswa=[],d.value.tp=[],i&&(f.value.body=!0,await R("/penilaian/get-cp",{method:"POST",body:{rombongan_belajar_id:s.value.rombongan_belajar_id,pembelajaran_id:s.value.pembelajaran_id,mata_pelajaran_id:s.value.mata_pelajaran_id,teknik_penilaian_id:s.value.teknik_penilaian_id},onResponse({response:e}){let m=e._data;E.value=m.show_cp,d.value.siswa=m.data_siswa,d.value.tp=m.data_tp,K.value=!1,A.value=!1,m.show_cp&&!m.data_tp.length&&(K.value=!0),d.value.siswa.length&&(A.value=!0),d.value.siswa.forEach(r=>{E.value?(I.value="Sumatif Lingkup Materi",b.opsi="sumatif-lingkup-materi",r.anggota_rombel.nilai_tp.length&&r.anggota_rombel.nilai_tp.forEach(n=>{u.value.tp[r.anggota_rombel.anggota_rombel_id+"#"+n.tp_id]=n.nilai})):(I.value="Sumatif Akhir Semester",b.opsi="sumatif-akhir-semester",r.anggota_rombel.nilai_sumatif.length&&r.anggota_rombel.nilai_sumatif.forEach(n=>{u.value.sumatif[r.anggota_rombel.anggota_rombel_id+"#"+n.jenis]=n.nilai}))}),q.value=`/downloads/template-${b.opsi}/${s.value.pembelajaran_id}`,f.value.body=!1}}))},oe=()=>{ae()},G=i=>{var e=0,m=0;i.forEach(function(n,x){e+=n,m++});var r=e/m;return r.toFixed(0)},H=(i,e)=>{var m=0,r=u.value.sumatif[`${i}#non-tes`],n=u.value.sumatif[`${i}#tes`];r&&n?m=G([parseInt(r),parseInt(n)]):r&&!n?m=r:!r&&n&&(m=n),u.value.sumatif[`${i}#na`]=m},h=p(!1),se=async i=>{h.value=!0;const e=new FormData;e.append("template_excel",i),e.append("rombongan_belajar_id",s.value.rombongan_belajar_id),e.append("pembelajaran_id",s.value.pembelajaran_id),e.append("sekolah_id",s.value.sekolah_id),e.append("merdeka",b.merdeka),e.append("opsi",b.opsi),await R("/penilaian/upload-nilai",{method:"POST",body:e,onResponse({response:m}){let r=m._data;h.value=!1,s.value.template_excel=null,r.data_nilai.forEach(n=>{if(b.opsi=="sumatif-lingkup-materi")n.nilai.forEach(j=>{u.value.tp[n.anggota_rombel_id+"#"+j.tp]=j.angka});else{u.value.sumatif[n.anggota_rombel_id+"#non-tes"]=n.nilai_non_tes,u.value.sumatif[n.anggota_rombel_id+"#tes"]=n.nilai_tes;var x=0;n.nilai_non_tes&&n.nilai_tes?x=G([n.nilai_non_tes,n.nilai_tes]):n.nilai_non_tes&&!n.nilai_tes?x=n.nilai_non_tes:!n.nilai_non_tes&&n.nilai_tes&&(x=n.nilai_tes),u.value.sumatif[n.anggota_rombel_id+"#na"]=x}})}})};return(i,e)=>{const m=fe,r=_e,n=ge("router-link"),x=pe,j=de,re=ue;return g(),F(ce,{class:"mb-6"},{default:o(()=>[t(Ve,{class:"pb-4"},{default:o(()=>[t(ke,null,{default:o(()=>e[11]||(e[11]=[T("Input Asesmen")])),_:1})]),_:1}),t(L),t(Te,{onSubmit:be(ee,["prevent"])},{default:o(()=>[t(Z,null,{default:o(()=>[t(B,null,{default:o(()=>[t(m,{form:a(s),"onUpdate:form":e[0]||(e[0]=l=>c(s)?s.value=l:null),errors:a(y),"onUpdate:errors":e[1]||(e[1]=l=>c(y)?y.value=l:null),arrayData:a(d),"onUpdate:arrayData":e[2]||(e[2]=l=>c(d)?d.value=l:null),loading:a(f),"onUpdate:loading":e[3]||(e[3]=l=>c(f)?f.value=l:null),resetForm:a(N),"onUpdate:resetForm":e[4]||(e[4]=l=>c(N)?N.value=l:null),isKunci:a(D),"onUpdate:isKunci":e[5]||(e[5]=l=>c(D)?D.value=l:null),onTingkat:le,onRombongan_belajar_id:te,onPembelajaran_id:ne},null,8,["form","errors","arrayData","loading","resetForm","isKunci"]),t(V,{cols:"12"},{default:o(()=>[t(B,{"no-gutters":""},{default:o(()=>[t(V,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:o(()=>e[12]||(e[12]=[_("label",{class:"v-label text-body-2 text-high-emphasis",for:"teknik_penilaian_id"},"Jenis Asesmen",-1)])),_:1}),t(V,{cols:"12",md:"9"},{default:o(()=>[t(r,{modelValue:a(s).teknik_penilaian_id,"onUpdate:modelValue":[e[6]||(e[6]=l=>a(s).teknik_penilaian_id=l),ie],placeholder:"== Pilih Jenis Asesmen ==",items:a(d).teknik,clearable:"","clear-icon":"tabler-x","item-value":"teknik_penilaian_id","item-title":"nama","error-messages":a(y).teknik_penilaian_id,loading:a(f).teknik_penilaian_id,disabled:a(f).teknik_penilaian_id||a(D)},null,8,["modelValue","items","error-messages","loading","disabled"])]),_:1})]),_:1})]),_:1}),a(d).siswa.length?(g(),F(V,{key:0,cols:"12"},{default:o(()=>[t(B,{"no-gutters":""},{default:o(()=>[t(V,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:o(()=>e[13]||(e[13]=[_("label",{class:"v-label text-body-2 text-high-emphasis",for:"template_excel"},"Template Excel",-1)])),_:1}),t(V,{cols:"12",md:"9"},{default:o(()=>[t(B,{"no-gutters":""},{default:o(()=>[t(V,{cols:"6"},{default:o(()=>[t(ye,{id:"template_excel",modelValue:a(s).template_excel,"onUpdate:modelValue":[e[7]||(e[7]=l=>a(s).template_excel=l),se],"error-messages":a(y).template_excel,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",label:"Unggah Template Excel"},null,8,["modelValue","error-messages"])]),_:1}),t(V,{cols:"6"},{default:o(()=>[t(X,{color:"primary",class:"ms-3",href:a(q),target:"_blank"},{default:o(()=>[T(" Unduh Template "+M(a(I)),1)]),_:1},8,["href"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1}),a(f).body?(g(),k("div",we,[t(Y,{size:60,indeterminate:"",color:"error",class:"my-10"})])):S("",!0),a(K)?(g(),F(xe,{key:1,color:"error",class:"text-center my-4",variant:"tonal"},{default:o(()=>[e[16]||(e[16]=_("h2",{class:"mt-4 mb-4"},"Tidak ditemukan data Tujuan Pembelajaran",-1)),_("p",null,[e[15]||(e[15]=T(" Silahkan tambah data Tujuan Pembelajaran terlebih dahulu ")),t(n,{to:{name:"referensi-tujuan-pembelajaran"}},{default:o(()=>e[14]||(e[14]=[T("disini")])),_:1})])]),_:1})):S("",!0)]),_:1}),t(L),a(d).siswa.length&&!a(h)?(g(),F(je,{key:0,class:"text-no-wrap"},{default:o(()=>[_("thead",null,[_("tr",null,[e[20]||(e[20]=_("th",{class:"text-center"},"Nama Peserta Didik",-1)),a(E)?(g(!0),k(C,{key:0},z(a(d).tp,(l,Q)=>(g(),k("th",$e,[T(M(`TP ${Q+1}`)+" ",1),t(Ue,{location:"top",activator:"parent",transition:"scale-transition"},{default:o(()=>[T(M(l.deskripsi),1)]),_:2},1024)]))),256)):(g(),k(C,{key:1},[e[17]||(e[17]=_("th",{class:"text-center"},"Non Tes",-1)),e[18]||(e[18]=_("th",{class:"text-center"},"Tes",-1)),e[19]||(e[19]=_("th",{class:"text-center"},"NA Sumatif Akhir Semester",-1))],64))])]),_("tbody",null,[(g(!0),k(C,null,z(a(d).siswa,(l,Q)=>(g(),k("tr",null,[_("td",null,[t(x,{item:l},null,8,["item"])]),a(E)?(g(!0),k(C,{key:0},z(a(d).tp,(v,Se)=>(g(),k("td",null,[_("div",De,[t(j,{type:"number",modelValue:a(u).tp[l.anggota_rombel.anggota_rombel_id+"#"+v.tp_id],"onUpdate:modelValue":me=>a(u).tp[l.anggota_rombel.anggota_rombel_id+"#"+v.tp_id]=me},null,8,["modelValue","onUpdate:modelValue"])])]))),256)):(g(),k(C,{key:1},[_("td",null,[t(j,{type:"number",modelValue:a(u).sumatif[l.anggota_rombel.anggota_rombel_id+"#non-tes"],"onUpdate:modelValue":[v=>a(u).sumatif[l.anggota_rombel.anggota_rombel_id+"#non-tes"]=v,v=>H(l.anggota_rombel.anggota_rombel_id,"#non-tes")]},null,8,["modelValue","onUpdate:modelValue"])]),_("td",null,[t(j,{type:"number",modelValue:a(u).sumatif[l.anggota_rombel.anggota_rombel_id+"#tes"],"onUpdate:modelValue":[v=>a(u).sumatif[l.anggota_rombel.anggota_rombel_id+"#tes"]=v,v=>H(l.anggota_rombel.anggota_rombel_id,"#tes")]},null,8,["modelValue","onUpdate:modelValue"])]),_("td",null,[t(j,{type:"number",modelValue:a(u).sumatif[l.anggota_rombel.anggota_rombel_id+"#na"],"onUpdate:modelValue":v=>a(u).sumatif[l.anggota_rombel.anggota_rombel_id+"#na"]=v,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])],64))]))),256))])]),_:1})):S("",!0),t(L),a(A)?(g(),F(Z,{key:1,class:"d-flex justify-end flex-wrap gap-3 pt-5 overflow-visible"},{default:o(()=>[t(X,{variant:"elevated",type:"submit",loading:a(U),disabled:a(U)},{default:o(()=>e[21]||(e[21]=[T(" Simpan ")])),_:1},8,["loading","disabled"])]),_:1})):S("",!0)]),_:1}),t(re,{isDialogVisible:a(P),"onUpdate:isDialogVisible":e[8]||(e[8]=l=>c(P)?P.value=l:null),isNotifVisible:a(w),"onUpdate:isNotifVisible":e[9]||(e[9]=l=>c(w)?w.value=l:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":a(W),"confirm-color":a($).color,"confirm-title":a($).title,"confirm-msg":a($).text,onClose:oe},null,8,["isDialogVisible","isNotifVisible","confirmation-text","confirm-color","confirm-title","confirm-msg"]),t(he,{modelValue:a(h),"onUpdate:modelValue":e[10]||(e[10]=l=>c(h)?h.value=l:null),contained:"",persistent:"","scroll-strategy":"none",class:"align-center justify-center"},{default:o(()=>[t(Y,{indeterminate:""})]),_:1},8,["modelValue"])]),_:1})}}};export{fa as default};
