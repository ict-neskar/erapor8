import{r as Y}from"./validators-CXK_eVNV.js";import{r as d,G as W,w as R,o as f,c as C,b as e,e as l,d as y,m as t,t as D,v as q,f as x,aa as I,$ as K,q as Z,ao as me,a2 as T,am as ee,ap as pe,F as ae,h as ke}from"./main-BUumBu6a.js";import{_ as se}from"./AlertDialog-D3FX3nmh.js";import{_ as H}from"./AppTextField-BkZ8OLsx.js";import{_ as re}from"./AppSelect-DwS2KVgh.js";import{u as J,c as X}from"./createUrl-C1_Sm4N7.js";import{d as $,a as U,$ as G}from"./mixins-CKlf8GuV.js";import{b as S,V as z}from"./VCard-BpJLDfhD.js";import{V as ne}from"./VSpacer-xEwlP4UK.js";import{V as de}from"./VDivider-BnEsdsgF.js";import{V as ue}from"./VDataTableServer-ndkNIZXv.js";import{V as te}from"./VChip-BQa_6tD-.js";import{$ as O}from"./api-DGas9VfV.js";import{V as le}from"./VTooltip-CEfZsqvI.js";import{V as ge}from"./VDialog-BEKtFyZX.js";import{V as oe}from"./VAlert-CuD5NV7H.js";import{V as N,a as P}from"./VRow-D5VnEZ_i.js";import{V as ce}from"./VOverlay-Bb4CDEq4.js";import{V as fe}from"./VForm-DjKeRf84.js";import{V as ve,b as ie,a as _e,c as be}from"./VTabs-CxeC6xxW.js";import"./VLabel-BS4UTjHC.js";import"./VImg-D2Juqgex.js";/* empty css                   */import"./VField-BQoKA9XH.js";import"./forwardRefs-DWGaNmQL.js";import"./VSelect-CUZzVBlY.js";import"./VList-DzyT1C46.js";import"./ssrBoot-BYz6_xqb.js";import"./VAvatar-Ba-Ggnm6.js";import"./VMenu-CW6Pdemc.js";import"./scopeId-CDzN2yrl.js";import"./VSelectionControl-C5g1YuyM.js";import"./index-BxkgbwWS.js";/* empty css              */import"./VTable-BUsnUoL5.js";import"./filter-Bl82YR7N.js";import"./VSlideGroup-DCwY19Ye.js";const ye={class:"d-flex gap-2 align-center"},Ve={class:"d-flex align-center flex-wrap gap-4"},we={__name:"MatevRapor",props:{isTabActive:{type:String,required:!0}},setup(M){const m=M,j=[{title:"Mata Pelajaran",key:"nm_mata_evaluasi",sortable:!0},{title:"Guru Mapel",key:"guru",sortable:!1},{title:"Nomor Urut",key:"no_urut",align:"center",sortable:!1},{title:"status",key:"status",align:"center",sortable:!1}],o=d({page:1,itemsPerPage:10,searchQuery:"",selectedRole:null,sortby:"mata_pelajaran_id",sortbydesc:"ASC"}),V=d(!1),p=d([]),w=d(0),_=v=>{var s,b;o.value.sortby=(s=v[0])==null?void 0:s.key,o.value.sortbydesc=(b=v[0])==null?void 0:b.order},h=async()=>{V.value=!0;try{let s=(await J(X("/sinkronisasi/get-matev-rapor",{query:{sekolah_id:$.sekolah_id,semester_id:U.semester_id,q:o.value.searchQuery,page:o.value.page,per_page:o.value.itemsPerPage,sortby:o.value.sortby,sortbydesc:o.value.sortbydesc}}))).data.value;p.value=s.data.data,w.value=s.data.total}catch(v){console.error(v)}finally{V.value=!1}};return W(async()=>{m.isTabActive=="Mata Evaluasi Rapor"&&await h()}),R(o,async()=>{await h()},{deep:!0}),R(()=>o.value.searchQuery,()=>{o.value.page=1}),R(m,async()=>{m.isTabActive=="Mata Evaluasi Rapor"&&await h()}),(v,s)=>{const b=re,k=H;return f(),C("div",null,[e(z,null,{default:l(()=>[e(S,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[y("div",ye,[e(b,{modelValue:t(o).itemsPerPage,"onUpdate:modelValue":s[0]||(s[0]=u=>t(o).itemsPerPage=u),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}],style:{"inline-size":"15.5rem"}},null,8,["modelValue"])]),e(ne),y("div",Ve,[e(k,{modelValue:t(o).searchQuery,"onUpdate:modelValue":s[1]||(s[1]=u=>t(o).searchQuery=u),placeholder:"Cari data",style:{"inline-size":"15.625rem"}},null,8,["modelValue"])])]),_:1}),e(de),e(ue,{page:t(o).page,"onUpdate:page":s[2]||(s[2]=u=>t(o).page=u),"items-per-page":t(o).itemsPerPage,"items-per-page-options":[{value:10,title:"10"},{value:20,title:"20"},{value:50,title:"50"},{value:100,title:"100"}],items:t(p),"server-items-length":t(w),"items-length":t(w),headers:j,"items-per-page-text":"Item",class:"text-no-wrap",options:t(o),loading:t(V),"loading-text":"Loading...","onUpdate:sortBy":_},{"item.guru":l(({item:u})=>[D(q(u.pembelajaran.guru.nama_lengkap),1)]),"item.status":l(({item:u})=>[u.status?(f(),x(te,{key:0,size:"small",color:"success"},{default:l(()=>s[3]||(s[3]=[D(" Terkirim ")])),_:1})):(f(),x(te,{key:1,size:"small",color:"error"},{default:l(()=>s[4]||(s[4]=[D(" Belum Terkirim ")])),_:1}))]),_:1},8,["page","items-per-page","items","server-items-length","items-length","options","loading"])]),_:1})])}}},De={class:"d-flex gap-2 align-center"},xe={class:"d-flex align-center flex-wrap gap-4"},he={__name:"RombonganBelajar",props:{isTabActive:{type:String,required:!0},urlDapodik:{type:String,default:""},tokenDapodik:{type:String,default:""}},setup(M){const m=M,j=[{title:"Kelas",key:"nama",sortable:!0},{title:"Wali Kelas",key:"wali_kelas",sortable:!1},{title:"Mata Evaluasi",key:"matev",align:"center",sortable:!1},{title:"Mata Evaluasi Terkirim",key:"matev_terkirim",align:"center",sortable:!1},{title:"Generate Matev",key:"generate_matev",align:"center",sortable:!1},{title:"Kirim Nilai",key:"nilai",align:"center",sortable:!1}],o=d({page:1,itemsPerPage:10,searchQuery:"",selectedRole:null,sortby:"nama",sortbydesc:"ASC"}),V=d(!1),p=d([]),w=d(0),_=d(),h=d(),v=a=>{var i,c;o.value.sortby=(i=a[0])==null?void 0:i.key,o.value.sortbydesc=(c=a[0])==null?void 0:c.order},s=async()=>{V.value=!0;try{let i=(await J(X("/sinkronisasi/rombongan-belajar",{query:{sekolah_id:$.sekolah_id,semester_id:U.semester_id,q:o.value.searchQuery,page:o.value.page,per_page:o.value.itemsPerPage,sortby:o.value.sortby,sortbydesc:o.value.sortbydesc}}))).data.value;p.value=i.data.data,w.value=i.data.total,_.value=i.url_dapodik,h.value=i.token_dapodik}catch(a){console.error(a)}finally{V.value=!1}},b=d(!1),k=d(!1),u=d({color:"",title:"",text:""});d();const Q=(a,i)=>{k.value=!0,E(a,i)},A=(a,i)=>{k.value=!0,F(a,i)},E=async(a,i)=>{await O("/sinkronisasi/matev-rapor",{method:"POST",body:{rombongan_belajar_id:a,nama_kelas:i},onResponse({request:c,response:r,options:L}){let n=r._data;u.value=n,k.value=!1,b.value=!0}})},F=async(a,i)=>{await O("/sinkronisasi/kirim-nilai",{method:"POST",body:{rombongan_belajar_id:a,nama_kelas:i,npsn:G.npsn,semester_id:U.semester_id,url_dapodik:m.urlDapodik,token_dapodik:m.tokenDapodik},onResponse({request:c,response:r,options:L}){let n=r._data;u.value=n,k.value=!1,b.value=!0}})},g=async()=>{await s()};return W(async()=>{m.isTabActive=="Rombongan Belajar"&&await s()}),R(o,async()=>{await s()},{deep:!0}),R(()=>o.value.searchQuery,()=>{o.value.page=1}),R(m,async()=>{m.isTabActive=="Rombongan Belajar"&&await s()},{deep:!0}),(a,i)=>{const c=re,r=H,L=se;return f(),C("div",null,[e(S,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[y("div",De,[e(c,{modelValue:t(o).itemsPerPage,"onUpdate:modelValue":i[0]||(i[0]=n=>t(o).itemsPerPage=n),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}],style:{"inline-size":"15.5rem"}},null,8,["modelValue"])]),e(ne),y("div",xe,[e(r,{modelValue:t(o).searchQuery,"onUpdate:modelValue":i[1]||(i[1]=n=>t(o).searchQuery=n),placeholder:"Cari data",style:{"inline-size":"15.625rem"}},null,8,["modelValue"])])]),_:1}),e(de),e(ue,{page:t(o).page,"onUpdate:page":i[2]||(i[2]=n=>t(o).page=n),"items-per-page":t(o).itemsPerPage,"items-per-page-options":[{value:10,title:"10"},{value:20,title:"20"},{value:50,title:"50"},{value:100,title:"100"}],items:t(p),"server-items-length":t(w),"items-length":t(w),headers:j,"items-per-page-text":"Item",class:"text-no-wrap",options:t(o),loading:t(V),"loading-text":"Loading...","onUpdate:sortBy":v},{"item.wali_kelas":l(({item:n})=>[D(q(n.wali_kelas.nama_lengkap),1)]),"item.generate_matev":l(({item:n})=>[n.pembelajaran_count?(f(),x(I,{key:0,color:"warning",size:"small",onClick:B=>Q(n.rombongan_belajar_id,n.nama)},{default:l(()=>[e(K,{start:"",icon:"tabler-bolt"}),i[5]||(i[5]=D("Generate "))]),_:2},1032,["onClick"])):(f(),x(le,{key:1,location:"top"},{activator:l(({props:B})=>[e(K,Z(B,{size:"30",icon:"tabler-help"}),null,16)]),default:l(()=>[y("span",null,"Kelas "+q(n.nama)+" belum memiliki Pembelajaran termapping!",1)]),_:2},1024))]),"item.nilai":l(({item:n})=>[n.matev?(f(),x(I,{key:0,color:"primary",size:"small",onClick:B=>A(n.rombongan_belajar_id,n.nama)},{default:l(()=>[e(K,{start:"",icon:"tabler-database"}),i[6]||(i[6]=D("Kirim Data "))]),_:2},1032,["onClick"])):(f(),x(le,{key:1,location:"top"},{activator:l(({props:B})=>[e(K,Z(B,{size:"30",icon:"tabler-help"}),null,16)]),default:l(()=>[y("span",null,"Kelas "+q(n.nama)+" belum memiliki Mata Evaluasi!",1)]),_:2},1024))]),_:1},8,["page","items-per-page","items","server-items-length","items-length","options","loading"]),e(ge,{modelValue:t(k),"onUpdate:modelValue":i[3]||(i[3]=n=>T(k)?k.value=n:null),width:"300",persistent:""},{default:l(()=>[e(z,{color:"primary",width:"300"},{default:l(()=>[e(S,{class:"pt-3"},{default:l(()=>[i[7]||(i[7]=D(" Mohon menunggu... ")),e(me,{indeterminate:"","bg-color":"rgba(var(--v-theme-surface), 0.1)",height:8,class:"mb-0 mt-4"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(L,{isDialogVisible:t(b),"onUpdate:isDialogVisible":i[4]||(i[4]=n=>T(b)?b.value=n:null),"confirm-color":t(u).color,"confirm-title":t(u).title,"confirm-msg":t(u).text,onConfirm:g},null,8,["isDialogVisible","confirm-color","confirm-title","confirm-msg"])])}}},da={__name:"kirim-nilai-dapodik",setup(M){const m=d("Rombongan Belajar"),j=["Rombongan Belajar","Mata Evaluasi Rapor"];W(async()=>{await h()});const o=d(!0),V=d(!1),p=d({url_dapodik:null,token_dapodik:null}),w=d(),_=d(""),h=async()=>{o.value=!0;try{let a=(await J(X("/sinkronisasi/nilai-dapodik",{query:{sekolah_id:$.sekolah_id,user_id:$.user_id,npsn:G.npsn,semester_id:U.semester_id,periode_aktif:U.nama}}))).data.value;V.value=!!a.url_dapodik,V.value&&(_.value="Rombongan Belajar"),p.value.url_dapodik=a.url_dapodik,p.value.token_dapodik=a.token_dapodik,w.value=a.dapodik}catch(g){console.error(g)}finally{o.value=!1}},v=d(!1),s=d({color:"",title:"",text:""}),b=g=>{_.value=g},k=d(!1),u=d(),Q=()=>{var g;(g=u.value)==null||g.validate().then(({valid:a})=>{a&&E()})},A=d({url_dapodik:void 0,token_dapodik:void 0}),E=async()=>{console.log("cekKoneksi"),k.value=!0,await O("/sinkronisasi/cek-koneksi",{method:"POST",body:{sekolah_id:$.sekolah_id,semester_id:U.semester_id,url_dapodik:p.value.url_dapodik,token_dapodik:p.value.token_dapodik,npsn:G.npsn},onResponse({request:g,response:a,options:i}){let c=a._data;console.log(c),k.value=!1,c.errors?A.value=c.errors:(A.value={url_dapodik:void 0,token_dapodik:void 0},s.value={color:c.color,title:c.title,text:c.text},v.value=!0)}})},F=()=>{k.value=!1,h()};return(g,a)=>{const i=H,c=se;return f(),C("div",null,[t(o)?(f(),x(z,{key:0,title:"Kirim Nilai ke Dapodik"},{default:l(()=>[e(S,{class:"text-center"},{default:l(()=>[e(ee,{size:60,indeterminate:"",color:"error",class:"my-10"})]),_:1})]),_:1})):(f(),x(z,{key:1,title:"Kirim Nilai ke Dapodik"},{default:l(()=>[t(V)?(f(),C(ae,{key:1},[e(S,{class:"mt-4"},{default:l(()=>[e(oe,{color:"warning"},{default:l(()=>a[12]||(a[12]=[y("h2",{class:"mt-4 mb-4 text-white"},"Informasi Penting",-1),y("p",null,"Prioritaskan pengiriman nilai semester pada tingkat akhir, nilai rapor 5 semester untuk siswa kelas 12 dan 7 semester untuk siswa kelas 13 ke Dapodik",-1)])),_:1})]),_:1}),e(ve,{modelValue:t(m),"onUpdate:modelValue":[a[3]||(a[3]=r=>T(m)?m.value=r:null),b],grow:""},{default:l(()=>[(f(),C(ae,null,ke(j,r=>e(be,{key:r,value:r},{default:l(()=>[D(q(r),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"]),e(_e,{modelValue:t(m),"onUpdate:modelValue":a[6]||(a[6]=r=>T(m)?m.value=r:null)},{default:l(()=>[e(ie,{value:"Rombongan Belajar"},{default:l(()=>[e(he,{isTabActive:t(_),"onUpdate:isTabActive":a[4]||(a[4]=r=>T(_)?_.value=r:null),"url-dapodik":t(p).url_dapodik,"token-dapodik":t(p).token_dapodik},null,8,["isTabActive","url-dapodik","token-dapodik"])]),_:1}),e(ie,{value:"Mata Evaluasi Rapor"},{default:l(()=>[e(we,{isTabActive:t(_),"onUpdate:isTabActive":a[5]||(a[5]=r=>T(_)?_.value=r:null)},null,8,["isTabActive"])]),_:1})]),_:1},8,["modelValue"])],64)):(f(),x(S,{key:0,class:"mt-4"},{default:l(()=>[e(oe,{color:"info",class:"mb-4"},{default:l(()=>a[8]||(a[8]=[y("h2",{class:"mt-4 mb-4 text-white"},"Pengaturan Web Services Dapodik",-1),y("p",null,"Untuk melakukan pengiriman nilai e-Rapor ke Dapodik, silahkan isi form dibawah ini:",-1)])),_:1}),e(fe,{ref_key:"refVForm",ref:u,onSubmit:pe(Q,["prevent"])},{default:l(()=>[e(N,null,{default:l(()=>[e(P,{cols:"12"},{default:l(()=>[e(N,{"no-gutters":""},{default:l(()=>[e(P,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:l(()=>a[9]||(a[9]=[y("label",{class:"v-label text-body-2 text-high-emphasis",for:"url_dapodik"},"URL Dapodik",-1)])),_:1}),e(P,{cols:"12",md:"9"},{default:l(()=>[e(i,{id:"url_dapodik",modelValue:t(p).url_dapodik,"onUpdate:modelValue":a[0]||(a[0]=r=>t(p).url_dapodik=r),placeholder:"Contoh: http://localhost:5774 (tanpa garis miring di akhir!)","persistent-placeholder":"",rules:["requiredValidator"in g?g.requiredValidator:t(Y)],"error-messages":t(A).url_dapodik},null,8,["modelValue","rules","error-messages"])]),_:1})]),_:1})]),_:1}),e(P,{cols:"12"},{default:l(()=>[e(N,{"no-gutters":""},{default:l(()=>[e(P,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:l(()=>a[10]||(a[10]=[y("label",{class:"v-label text-body-2 text-high-emphasis",for:"token_dapodik"},"Token Dapodik",-1)])),_:1}),e(P,{cols:"12",md:"9"},{default:l(()=>[e(i,{id:"token_dapodik",modelValue:t(p).token_dapodik,"onUpdate:modelValue":a[1]||(a[1]=r=>t(p).token_dapodik=r),placeholder:"Token Dapodik","persistent-placeholder":"",rules:["requiredValidator"in g?g.requiredValidator:t(Y)],"error-messages":t(A).token_dapodik},null,8,["modelValue","rules","error-messages"])]),_:1})]),_:1})]),_:1}),e(P,{"offset-md":"3",cols:"12",md:"9",class:"d-flex gap-4"},{default:l(()=>[e(I,{type:"submit"},{default:l(()=>a[11]||(a[11]=[D(" Cek Koneksi ")])),_:1})]),_:1}),e(ce,{modelValue:t(k),"onUpdate:modelValue":a[2]||(a[2]=r=>T(k)?k.value=r:null),contained:"",persistent:"","scroll-strategy":"none",class:"align-center justify-center"},{default:l(()=>[e(ee,{indeterminate:""})]),_:1},8,["modelValue"])]),_:1})]),_:1},512)]),_:1}))]),_:1})),e(c,{isDialogVisible:t(v),"onUpdate:isDialogVisible":a[7]||(a[7]=r=>T(v)?v.value=r:null),"confirm-color":t(s).color,"confirm-title":t(s).title,"confirm-msg":t(s).text,onConfirm:F},null,8,["isDialogVisible","confirm-color","confirm-title","confirm-msg"])])}}};export{da as default};
