import{_ as ge}from"./ConfirmDialog-CoWyGp8W.js";import{_ as be}from"./AppTextField-bfe1muJ5.js";import{_ as ve}from"./ProfileSiswa-CNtxoAVM.js";import{_ as ce}from"./AppSelect-C873-ZzL.js";import{_ as ke}from"./DefaultForm-ChBfONz9.js";import{r as d,G as ye,f as c,e as o,a as Ve,o as _,b as t,t as T,m as a,am as J,ap as xe,a2 as k,d as f,aa as le,v as L,y as S,c as y,h as W,F as C}from"./main-BbIknAU_.js";import{$ as A}from"./api-zDHFqD3S.js";import{a as te,d as O}from"./mixins-D9sK_GNK.js";import{V as je,c as he,a as Te,b as I}from"./VCard-DP6R80QM.js";import{V as q}from"./VDivider-AdngBwQk.js";import{V as we}from"./VForm-BMhz_qEl.js";import{V as K,a as V}from"./VRow-BRHNHyL4.js";import{V as Ue}from"./VFileInput-CDHJkEDy.js";import{V as G}from"./VAlert-DUdVz0cu.js";import{V as Se}from"./VTable-D6I1NIoz.js";import{V as De}from"./VOverlay-CegGukY1.js";import{V as $e}from"./VTooltip-BUhMNqPw.js";import"./VDialog-AuNDjXN_.js";import"./forwardRefs-DWGaNmQL.js";import"./scopeId-Cm6oLMEy.js";import"./VLabel-BKB7GbBW.js";import"./VImg-C0bob0hg.js";/* empty css                   */import"./VField-CiROKIcN.js";import"./VAvatar-DhWlB6rZ.js";import"./VSelect-B8TBIhr3.js";import"./VList-CU7bhzU4.js";import"./ssrBoot-DItPKqse.js";import"./VMenu-RccmEXkB.js";import"./VSelectionControl-BTie8rgs.js";import"./VChip-L5Rr2CRm.js";import"./VSlideGroup-BPY7Rwgf.js";import"./AppAutocomplete-Br1PWZIT.js";import"./filter-DNqhOXQ6.js";import"./index-BxkgbwWS.js";/* empty css              */const Fe={key:0,class:"text-center"},Pe={class:"text-center"},Ce={style:{"inline-size":"4rem"}},ca={__name:"asesmen-sumatif",setup(Ae){const H=d(!0),Q=d(!0),ne=async()=>{try{const i=await A("/setting/status-penilaian",{method:"POST",body:{sekolah_id:O.sekolah_id,semester_id:te.semester_id}});Q.value=i}catch(i){console.error(i)}finally{H.value=!1}};ye(async()=>{await ne()});const M=d(""),X=d(""),s=d({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,teknik_penilaian_id:null,template_excel:null}),p=d({tp:{},sumatif:{}}),x=d({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,teknik_penilaian_id:null,template_excel:null}),u=d({rombel:[],mapel:[],teknik:[],siswa:[],tp:[]}),g=d({rombel:!1,mapel:!1,teknik_penilaian_id:!1,body:!1}),D=d(!1),$=d(!1),N=d(!1),F=d(!1),Y=d(""),P=d({color:"",title:"",text:""}),ie=async()=>{$.value=!0;const i={...b,...s.value,...p.value};await A("/penilaian/simpan",{method:"POST",body:i,onResponse({response:e}){let m=e._data;$.value=!1,m.errors?x.value=m.errors:(F.value=!0,P.value=m)}})},b={opsi:"",semester_id:te.semester_id,user_id:O.user_id,guru_id:O.guru_id,sekolah_id:O.sekolah_id,merdeka:!1},E=d(!1),oe=()=>{E.value=!0,s.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,teknik_penilaian_id:null,template_excel:null},p.value={tp:{},sumatif:{}},x.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,teknik_penilaian_id:null,template_excel:null},u.value={rombel:[],mapel:[],teknik:[],siswa:[],tp:[]},g.value={rombel:!1,mapel:!1,teknik_penilaian_id:!1,body:!1},D.value=!1,$.value=!1,N.value=!1,F.value=!1,Y.value="",P.value={color:"",title:"",text:""},b.opsi=""},w=d(!1),z=async i=>{const e={...i,...b};await A("/referensi/get-data",{method:"POST",body:e,onResponse({response:m}){u.value.siswa=[],R.value=!1,D.value=!1;let r=m._data;i.data=="rombel"&&(u.value.rombel=r),i.data=="mapel"&&(u.value.mapel=r.mapel,b.merdeka=r.merdeka,w.value=!!r.rombel.kunci_nilai),i.data=="teknik"&&(u.value.teknik=r)}})},se=async i=>{s.value.rombongan_belajar_id=null,s.value.pembelajaran_id=null,s.value.mata_pelajaran_id=null,i&&(g.value.rombel=!0,await z({data:"rombel",nilai:1,tingkat:i}).then(()=>{g.value.rombel=!1}))},re=async i=>{s.value.pembelajaran_id=null,s.value.mata_pelajaran_id=null,i&&(g.value.mapel=!0,await z({data:"mapel",nilai:1,rombongan_belajar_id:i}).then(()=>{g.value.mapel=!1}))},me=async i=>{s.value.teknik_penilaian_id=null,i&&(g.value.teknik_penilaian_id=!0,await z({data:"teknik"}).then(()=>{g.value.teknik_penilaian_id=!1}))},R=d(!1),B=d(!1),ue=async i=>{u.value.siswa=[],u.value.tp=[],i&&(g.value.body=!0,await A("/penilaian/get-cp",{method:"POST",body:{rombongan_belajar_id:s.value.rombongan_belajar_id,pembelajaran_id:s.value.pembelajaran_id,mata_pelajaran_id:s.value.mata_pelajaran_id,teknik_penilaian_id:s.value.teknik_penilaian_id},onResponse({response:e}){let m=e._data;B.value=m.show_cp,u.value.siswa=m.data_siswa,u.value.tp=m.data_tp,R.value=!1,D.value=!1,m.show_cp&&!m.data_tp.length&&(R.value=!0),u.value.siswa.length&&(D.value=!0),u.value.siswa.forEach(r=>{B.value?(M.value="Sumatif Lingkup Materi",b.opsi="sumatif-lingkup-materi",r.anggota_rombel.nilai_tp.length&&r.anggota_rombel.nilai_tp.forEach(n=>{p.value.tp[r.anggota_rombel.anggota_rombel_id+"#"+n.tp_id]=n.nilai})):(M.value="Sumatif Akhir Semester",b.opsi="sumatif-akhir-semester",r.anggota_rombel.nilai_sumatif.length&&r.anggota_rombel.nilai_sumatif.forEach(n=>{p.value.sumatif[r.anggota_rombel.anggota_rombel_id+"#"+n.jenis]=n.nilai}))}),X.value=`/downloads/template-${b.opsi}/${s.value.pembelajaran_id}`,g.value.body=!1}}))},de=()=>{oe()},Z=i=>{var e=0,m=0;i.forEach(function(n,j){e+=n,m++});var r=e/m;return r.toFixed(0)},ee=(i,e)=>{var m=0,r=p.value.sumatif[`${i}#non-tes`],n=p.value.sumatif[`${i}#tes`];r&&n?m=Z([parseInt(r),parseInt(n)]):r&&!n?m=r:!r&&n&&(m=n),p.value.sumatif[`${i}#na`]=m},U=d(!1),pe=async i=>{U.value=!0;const e=new FormData;e.append("template_excel",i),e.append("rombongan_belajar_id",s.value.rombongan_belajar_id),e.append("pembelajaran_id",s.value.pembelajaran_id),e.append("sekolah_id",s.value.sekolah_id),e.append("merdeka",b.merdeka),e.append("opsi",b.opsi),await A("/penilaian/upload-nilai",{method:"POST",body:e,onResponse({response:m}){let r=m._data;U.value=!1,s.value.template_excel=null,r.data_nilai.forEach(n=>{if(b.opsi=="sumatif-lingkup-materi")n.nilai.forEach(h=>{p.value.tp[n.anggota_rombel_id+"#"+h.tp]=h.angka});else{p.value.sumatif[n.anggota_rombel_id+"#non-tes"]=n.nilai_non_tes,p.value.sumatif[n.anggota_rombel_id+"#tes"]=n.nilai_tes;var j=0;n.nilai_non_tes&&n.nilai_tes?j=Z([n.nilai_non_tes,n.nilai_tes]):n.nilai_non_tes&&!n.nilai_tes?j=n.nilai_non_tes:!n.nilai_non_tes&&n.nilai_tes&&(j=n.nilai_tes),p.value.sumatif[n.anggota_rombel_id+"#na"]=j}})}})};return(i,e)=>{const m=ke,r=ce,n=Ve("router-link"),j=ve,h=be,_e=ge;return _(),c(je,{class:"mb-6"},{default:o(()=>[t(Te,{class:"pb-4"},{default:o(()=>[t(he,null,{default:o(()=>e[11]||(e[11]=[T("Input Asesmen")])),_:1})]),_:1}),t(q),a(H)?(_(),c(I,{key:0,class:"text-center"},{default:o(()=>[t(J,{size:60,indeterminate:"",color:"error",class:"my-10"})]),_:1})):a(Q)?(_(),c(we,{key:1,onSubmit:xe(ie,["prevent"])},{default:o(()=>[t(I,null,{default:o(()=>[t(K,null,{default:o(()=>[t(m,{form:a(s),"onUpdate:form":e[0]||(e[0]=l=>k(s)?s.value=l:null),errors:a(x),"onUpdate:errors":e[1]||(e[1]=l=>k(x)?x.value=l:null),arrayData:a(u),"onUpdate:arrayData":e[2]||(e[2]=l=>k(u)?u.value=l:null),loading:a(g),"onUpdate:loading":e[3]||(e[3]=l=>k(g)?g.value=l:null),resetForm:a(E),"onUpdate:resetForm":e[4]||(e[4]=l=>k(E)?E.value=l:null),isKunci:a(w),"onUpdate:isKunci":e[5]||(e[5]=l=>k(w)?w.value=l:null),onTingkat:se,onRombongan_belajar_id:re,onPembelajaran_id:me},null,8,["form","errors","arrayData","loading","resetForm","isKunci"]),t(V,{cols:"12"},{default:o(()=>[t(K,{"no-gutters":""},{default:o(()=>[t(V,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:o(()=>e[12]||(e[12]=[f("label",{class:"v-label text-body-2 text-high-emphasis",for:"teknik_penilaian_id"},"Jenis Asesmen",-1)])),_:1}),t(V,{cols:"12",md:"9"},{default:o(()=>[t(r,{modelValue:a(s).teknik_penilaian_id,"onUpdate:modelValue":[e[6]||(e[6]=l=>a(s).teknik_penilaian_id=l),ue],placeholder:"== Pilih Jenis Asesmen ==",items:a(u).teknik,clearable:"","clear-icon":"tabler-x","item-value":"teknik_penilaian_id","item-title":"nama","error-messages":a(x).teknik_penilaian_id,loading:a(g).teknik_penilaian_id,disabled:a(g).teknik_penilaian_id||a(w)},null,8,["modelValue","items","error-messages","loading","disabled"])]),_:1})]),_:1})]),_:1}),a(u).siswa.length?(_(),c(V,{key:0,cols:"12"},{default:o(()=>[t(K,{"no-gutters":""},{default:o(()=>[t(V,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:o(()=>e[13]||(e[13]=[f("label",{class:"v-label text-body-2 text-high-emphasis",for:"template_excel"},"Template Excel",-1)])),_:1}),t(V,{cols:"12",md:"9"},{default:o(()=>[t(K,{"no-gutters":""},{default:o(()=>[t(V,{cols:"6"},{default:o(()=>[t(Ue,{id:"template_excel",modelValue:a(s).template_excel,"onUpdate:modelValue":[e[7]||(e[7]=l=>a(s).template_excel=l),pe],"error-messages":a(x).template_excel,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",label:"Unggah Template Excel"},null,8,["modelValue","error-messages"])]),_:1}),t(V,{cols:"6"},{default:o(()=>[t(le,{color:"primary",class:"ms-3",href:a(X),target:"_blank"},{default:o(()=>[T(" Unduh Template "+L(a(M)),1)]),_:1},8,["href"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1}),a(g).body?(_(),y("div",Fe,[t(J,{size:60,indeterminate:"",color:"error",class:"my-10"})])):S("",!0),a(R)?(_(),c(G,{key:1,color:"error",class:"text-center my-4",variant:"tonal"},{default:o(()=>[e[16]||(e[16]=f("h2",{class:"mt-4 mb-4"},"Tidak ditemukan data Tujuan Pembelajaran",-1)),f("p",null,[e[15]||(e[15]=T(" Silahkan tambah data Tujuan Pembelajaran terlebih dahulu ")),t(n,{to:{name:"referensi-tujuan-pembelajaran"}},{default:o(()=>e[14]||(e[14]=[T("disini")])),_:1})])]),_:1})):S("",!0),a(w)?(_(),c(G,{key:2,color:"error",class:"text-center my-4",variant:"tonal"},{default:o(()=>e[17]||(e[17]=[f("h2",{class:"mt-4 mb-4"},"Penilaian tidak aktif. Silahkan hubungi Wali Kelas!",-1)])),_:1})):S("",!0)]),_:1}),t(q),a(u).siswa.length&&!a(U)?(_(),c(Se,{key:0,class:"text-no-wrap"},{default:o(()=>[f("thead",null,[f("tr",null,[e[21]||(e[21]=f("th",{class:"text-center"},"Nama Peserta Didik",-1)),a(B)?(_(!0),y(C,{key:0},W(a(u).tp,(l,ae)=>(_(),y("th",Pe,[T(L(`TP ${ae+1}`)+" ",1),t($e,{location:"top",activator:"parent",transition:"scale-transition"},{default:o(()=>[T(L(l.deskripsi),1)]),_:2},1024)]))),256)):(_(),y(C,{key:1},[e[18]||(e[18]=f("th",{class:"text-center"},"Non Tes",-1)),e[19]||(e[19]=f("th",{class:"text-center"},"Tes",-1)),e[20]||(e[20]=f("th",{class:"text-center"},"NA Sumatif Akhir Semester",-1))],64))])]),f("tbody",null,[(_(!0),y(C,null,W(a(u).siswa,(l,ae)=>(_(),y("tr",null,[f("td",null,[t(j,{item:l},null,8,["item"])]),a(B)?(_(!0),y(C,{key:0},W(a(u).tp,(v,Ne)=>(_(),y("td",null,[f("div",Ce,[t(h,{type:"number",modelValue:a(p).tp[l.anggota_rombel.anggota_rombel_id+"#"+v.tp_id],"onUpdate:modelValue":fe=>a(p).tp[l.anggota_rombel.anggota_rombel_id+"#"+v.tp_id]=fe},null,8,["modelValue","onUpdate:modelValue"])])]))),256)):(_(),y(C,{key:1},[f("td",null,[t(h,{type:"number",modelValue:a(p).sumatif[l.anggota_rombel.anggota_rombel_id+"#non-tes"],"onUpdate:modelValue":[v=>a(p).sumatif[l.anggota_rombel.anggota_rombel_id+"#non-tes"]=v,v=>ee(l.anggota_rombel.anggota_rombel_id,"#non-tes")]},null,8,["modelValue","onUpdate:modelValue"])]),f("td",null,[t(h,{type:"number",modelValue:a(p).sumatif[l.anggota_rombel.anggota_rombel_id+"#tes"],"onUpdate:modelValue":[v=>a(p).sumatif[l.anggota_rombel.anggota_rombel_id+"#tes"]=v,v=>ee(l.anggota_rombel.anggota_rombel_id,"#tes")]},null,8,["modelValue","onUpdate:modelValue"])]),f("td",null,[t(h,{type:"number",modelValue:a(p).sumatif[l.anggota_rombel.anggota_rombel_id+"#na"],"onUpdate:modelValue":v=>a(p).sumatif[l.anggota_rombel.anggota_rombel_id+"#na"]=v,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])],64))]))),256))])]),_:1})):S("",!0),t(q),a(D)?(_(),c(I,{key:1,class:"d-flex justify-end flex-wrap gap-3 pt-5 overflow-visible"},{default:o(()=>[t(le,{variant:"elevated",type:"submit",loading:a($),disabled:a($)},{default:o(()=>e[22]||(e[22]=[T(" Simpan ")])),_:1},8,["loading","disabled"])]),_:1})):S("",!0)]),_:1})):(_(),c(I,{key:2},{default:o(()=>[t(G,{color:"error",class:"text-center my-4",variant:"tonal"},{default:o(()=>e[23]||(e[23]=[f("h2",{class:"mt-4 mb-4"},"Penilaian tidak aktif. Silahkan hubungi administrator!",-1)])),_:1})]),_:1})),t(_e,{isDialogVisible:a(N),"onUpdate:isDialogVisible":e[8]||(e[8]=l=>k(N)?N.value=l:null),isNotifVisible:a(F),"onUpdate:isNotifVisible":e[9]||(e[9]=l=>k(F)?F.value=l:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":a(Y),"confirm-color":a(P).color,"confirm-title":a(P).title,"confirm-msg":a(P).text,onClose:de},null,8,["isDialogVisible","isNotifVisible","confirmation-text","confirm-color","confirm-title","confirm-msg"]),t(De,{modelValue:a(U),"onUpdate:modelValue":e[10]||(e[10]=l=>k(U)?U.value=l:null),contained:"",persistent:"","scroll-strategy":"none",class:"align-center justify-center"},{default:o(()=>[t(J,{indeterminate:""})]),_:1},8,["modelValue"])]),_:1})}}};export{ca as default};
