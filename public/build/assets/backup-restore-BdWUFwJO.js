import{_ as Q}from"./ConfirmDialog-BeQZcop1.js";import{u as X,c as Y}from"./createUrl-5K3jXwP3.js";import{$ as P}from"./api-bn4q6wV9.js";import{V as R,a as q,c as E,b}from"./VCard-B6efkknt.js";import{G as Z,r,c as p,b as l,e as s,m as a,a2 as I,o as i,aa as _,t as n,F as g,am as L,f as U,d as t,v as d,h as M,y as C,ao as h,$ as O}from"./main-WcaAB0Vb.js";import{V as $}from"./VDivider-DIWjfe5J.js";import{V as ee}from"./VAlert-CjOr7Ksk.js";import{V as ae}from"./VTable-Dxydgzys.js";import{V as te}from"./VFileInput-BxfRpVfA.js";import"./VDialog-B8hMcs5D.js";import"./VOverlay-Baakzd79.js";import"./forwardRefs-DWGaNmQL.js";import"./scopeId-UpMB3NtI.js";import"./VImg-BR-W7-GF.js";import"./index-BxkgbwWS.js";import"./VAvatar-C5PogN-2.js";import"./VField-Bv5GDULG.js";import"./VLabel-6jXlAgoN.js";import"./VChip-LzakvH-4.js";import"./VSlideGroup-aRldGfCL.js";const le={class:"mt-4 mb-4"},se={class:"text-center"},oe={key:1},re={style:{margin:"0 20px 0px"}},ne={style:{margin:"0 15px 0px"}},_e={__name:"backup-restore",setup(ie){Z(async()=>{await V()});const w=r(!0),k=r(!1),v=r([]),F=r(),A=r(),y=r({}),f=r(),V=async()=>{try{let e=(await X(Y("/setting",{query:{data:"backup"}}))).data.value;v.value=e.files,F.value=e.path,A.value=e.folder,y.value=e.db}catch(u){console.error(u)}finally{w.value=!1}},H=async()=>{console.log("prosesBackup"),k.value=!0,await P("/setting/proses-backup",{method:"POST",onResponse({response:u}){let e=u._data;f.value=e,k.value=!1,V()}})},x=r({zip_file:null}),J=r({zip_file:null}),N=r(!1),T=r(0),G=async()=>{N.value=!0;const u=new FormData;u.append("zip_file",x.value.zip_file);try{await P("/setting/upload-restore",{method:"POST",body:u,onUploadProgress:e=>{T.value=Math.round(e.loaded*100/e.total)}})}catch(e){console.error(e)}finally{x.value.zip_file=null,N.value=!1,await V()}},D=r(!1),m=r(!1),c=r({color:"",title:"",text:""}),z=r([]),B=r(),W=async u=>{B.value=u,D.value=!0},j=async()=>{z.value[B.value]=!0,await P("/setting/hapus-file",{method:"POST",body:{zip_file:B.value},onResponse({request:u,response:e,options:S}){let o=e._data;z.value[B.value]=!1,c.value=o,m.value=!0}})},K=async()=>{m.value=!1,setTimeout(()=>{c.value={color:"",title:"",text:""}},300),await V()};return(u,e)=>{const S=Q;return i(),p("section",null,[l(R,{class:"mb-6"},{default:s(()=>[l(q,{class:"pb-6"},{append:s(()=>[l(_,{"prepend-icon":"tabler-database",onClick:e[0]||(e[0]=o=>H("unduh")),loading:a(k),disabled:a(k)},{default:s(()=>e[5]||(e[5]=[n(" Proses Backup ")])),_:1},8,["loading","disabled"])]),default:s(()=>[l(E,null,{default:s(()=>e[4]||(e[4]=[n("Backup Database")])),_:1})]),_:1}),a(w)?(i(),p(g,{key:0},[l($),l(b,{class:"text-center"},{default:s(()=>[l(L,{size:60,indeterminate:"",color:"error"})]),_:1})],64)):(i(),p(g,{key:1},[a(f)?(i(),U(b,{key:0},{default:s(()=>[l(ee,{color:a(f).exitCode?"error":"success",variant:"tonal"},{default:s(()=>[t("h2",le,d(a(f).message),1),t("ul",null,[(i(!0),p(g,null,M(a(f).output,o=>(i(),p("li",null,d(o),1))),256))])]),_:1},8,["color"])]),_:1})):C("",!0),l(ae,{class:"text-no-wrap"},{default:s(()=>[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"Waktu Backup"),t("th",null,"Ukuran Berkas"),t("th",{class:"text-center"},"Aksi")])],-1)),t("tbody",null,[a(v).length?(i(!0),p(g,{key:0},M(a(v),o=>(i(),p("tr",null,[t("td",null,d(o.fileDate),1),t("td",null,d(o.fileSize)+" MB",1),t("td",se,[l(_,{size:"small",color:"success",href:`/downloads/backup/${o.fileName}`,class:"me-2"},{default:s(()=>[l(O,{start:"",icon:"tabler-download"}),e[6]||(e[6]=n(" Unduh "))]),_:2},1032,["href"]),l(_,{size:"small",color:"error",onClick:ue=>W(o.fileName),loading:a(z)[o.fileName],disabled:a(z)[o.fileName]},{default:s(()=>[l(O,{start:"",icon:"tabler-trash"}),e[7]||(e[7]=n(" Hapus "))]),_:2},1032,["onClick","loading","disabled"])])]))),256)):(i(),p("tr",oe,e[8]||(e[8]=[t("td",{class:"text-center",colspan:"3"},"Tidak ada data untuk ditampilkan",-1)])))])]),_:1})],64)),a(v).length?(i(),U(b,{key:2},{default:s(()=>[e[19]||(e[19]=t("p",null,"Proses restore database",-1)),t("ol",re,[e[18]||(e[18]=t("li",null,"Buka cmd/ssh",-1)),t("li",null,[e[17]||(e[17]=n("Jalankan: ")),t("ul",ne,[t("li",null,[t("code",null,"cd "+d(a(F)),1),e[10]||(e[10]=n("[Enter]"))]),e[15]||(e[15]=t("li",null,[t("code",null,"php artisan app:restore"),n("[Enter]")],-1)),t("li",null,[e[13]||(e[13]=n("Jika ada notifikasi ")),t("code",null,[n('Proceed to restore "'+d(a(A))+'/nama-file-database.zip" using the "'+d(a(y).driver)+'" database connection. (Database: nama-database, Host: '+d(a(y).host)+", username: "+d(a(y).username)+"): (yes/no) [",1),e[11]||(e[11]=t("span",{class:"text-warning"},"yes",-1)),e[12]||(e[12]=n("]"))]),e[14]||(e[14]=n(", tekan tombol Enter "))]),e[16]||(e[16]=t("li",null,"Tunggu sampai proses restore database selesai.",-1))])])])]),_:1})):C("",!0)]),_:1}),l(R,{class:"mb-6"},{default:s(()=>[l(q,{class:"pb-6"},{default:s(()=>[l(E,null,{default:s(()=>e[20]||(e[20]=[n("Restore Database")])),_:1})]),_:1}),l($),a(w)?(i(),p(g,{key:0},[l($),l(b,{class:"text-center"},{default:s(()=>[l(L,{size:60,indeterminate:"",color:"error"})]),_:1})],64)):C("",!0),l(b,null,{default:s(()=>[l(te,{modelValue:a(x).zip_file,"onUpdate:modelValue":[e[1]||(e[1]=o=>a(x).zip_file=o),G],"error-messages":a(J).zip_file,accept:".zip",label:"Unggah Berkas Database (.zip)"},null,8,["modelValue","error-messages"]),a(N)?(i(),U(h,{key:0,value:a(T),color:"primary",height:"25",class:"mt-4"},{default:s(()=>[n(d(a(T))+"% ",1)]),_:1},8,["value"])):C("",!0)]),_:1})]),_:1}),l(S,{isDialogVisible:a(D),"onUpdate:isDialogVisible":e[2]||(e[2]=o=>I(D)?D.value=o:null),isNotifVisible:a(m),"onUpdate:isNotifVisible":e[3]||(e[3]=o=>I(m)?m.value=o:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":"Tindakan ini tidak dapat dikembalikan!","confirm-color":a(c).color,"confirm-title":a(c).title,"confirm-msg":a(c).text,onConfirm:j,onClose:K},null,8,["isDialogVisible","isNotifVisible","confirm-color","confirm-title","confirm-msg"])])}}};export{_e as default};
