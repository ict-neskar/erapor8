import{a as w,d as J}from"./mixins-BjVJEZvR.js";import{_ as Pe}from"./AlertDialog-CuzkofM7.js";import{_ as Ce}from"./ConfirmDialog-BLscZHWo.js";import{_ as $e}from"./DialogCloseBtn-EZZA6T1w.js";import{_ as De}from"./TablePagination-BRD4F1BT.js";import{_ as Te}from"./AppTextField-Bdwte880.js";import{_ as Ae}from"./AppSelect-DFrAhbhb.js";import{b as Ue}from"./index-NOZ-zHIz.js";import{u as Re,c as Se}from"./createUrl-8zoAcX36.js";import{$ as z}from"./api-Bkbcc4ec.js";import{V as K,a as ae,c as te,b as x}from"./VCard-CswHtBsG.js";import{V as se}from"./VDialog-BkAb0UEZ.js";import{r as i,G as Be,w as oe,c as P,b as t,e as s,m as l,a2 as C,o as c,aa as k,t as f,d as o,v as g,F as I,f as $,h as ne,y as M}from"./main-4ibPTuoX.js";import{V as L}from"./VDivider-DBczu0Ow.js";import{V as ie}from"./VSpacer-DBg6JrlZ.js";import{V as Ne}from"./VDataTableServer-BXGcUj1U.js";import{V as ze}from"./VAvatar-DuOErqu_.js";import{V as Ie}from"./VImg-B9UUOYt7.js";import{V as re}from"./VChip-ClHLREYK.js";import{V as ue}from"./VTable-CFJBDt5I.js";import{V as Le}from"./VCheckbox-i2ohfFlx.js";import"./VLabel-B0eCB5jg.js";/* empty css                   */import"./VField-DDWomVtf.js";import"./forwardRefs-DWGaNmQL.js";import"./VSelect-CJIVueWh.js";import"./VList-DRMF5v6F.js";import"./ssrBoot-CGBhTCaE.js";import"./VOverlay-Dt1Dy2Gr.js";import"./scopeId-DgdHYkHx.js";import"./VMenu-HPtXLDMp.js";import"./VSelectionControl-Dw3cA4UE.js";import"./index-BxkgbwWS.js";/* empty css              */import"./filter-CCPSJzNa.js";import"./VSlideGroup-DECG9arN.js";const qe={class:"me-3 d-flex gap-3"},he={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},je={style:{"inline-size":"15.625rem"}},He={class:"d-flex align-center gap-x-4"},Qe={class:"d-flex flex-column"},Fe={class:"text-base"},Oe={class:"text-sm"},Ge={class:"text-center"},Ee={class:"text-lg font-weight-medium"},Rl={__name:"pengguna",setup(Je){const r=i({page:1,itemsPerPage:10,searchQuery:"",selectedRole:null,sortby:"name",sortbydesc:"ASC"}),de=[{title:"Pengguna",key:"name",nowrap:!0},{title:"Jenis Pengguna",key:"roles",sortable:!1},{title:"Terakhir Login",key:"login_terakhir",sortable:!1},{title:"password",key:"password",sortable:!1},{title:"Aksi",key:"actions",align:"center",sortable:!1,nowrap:!0}],q=i([]),R=i(0),b=i([]),h=i(!1);Be(async()=>{await j()}),oe(r,async()=>{await j()},{deep:!0}),oe(()=>r.value.searchQuery,()=>{r.value.page=1});const me=n=>{var e,u;r.value.sortby=(e=n[0])==null?void 0:e.key,r.value.sortbydesc=(u=n[0])==null?void 0:u.order},j=async()=>{h.value=!0,q.value=[],R.value=[],b.value=[];try{let e=(await Re(Se("/setting/users",{query:{q:r.value.searchQuery,page:r.value.page,per_page:r.value.itemsPerPage,periode_aktif:w.nama,sekolah_id:J.sekolah_id,role_id:r.value.selectedRole,sortby:r.value.sortby,sortbydesc:r.value.sortbydesc}}))).data;q.value=e.value.data.data,R.value=e.value.data.total,b.value=e.value.roles}catch(n){console.error(n)}finally{h.value=!1}},D=i([]),pe=n=>{var e=n.map(u=>u.display_name);return e.join(", ")},H=(n,e)=>e?Ue.compareSync(e,n):!1,y=i(!1),_=i(!1),W=i(),Q=i(),X=async n=>{W.value=n,n=="new"?Q.value="Generate Pengguna":Q.value="Unduh Pengguna",_.value=!0},Y=async n=>{W.value=="new"?(y.value=!0,await z("/setting/generate-pengguna",{method:"POST",body:{aksi:n,semester_id:w.semester_id,sekolah_id:J.sekolah_id,periode_aktif:w.nama},onResponse({request:e,response:u,options:v}){let m=u._data;y.value=!1,_.value=!1,p.value.color=m.color,p.value.title=m.title,p.value.text=m.text,U.value=!0}})):(_.value=!1,window.open(`/downloads/pengguna/${n}/${J.sekolah_id}/${w.semester_id}`,"_blank"))},S=i([]),V=i(!1),T=i(!1),A=i(!1),Z=i(),d=i({userId:null,nama:null,email:null,password:null,defaultPassword:null,lastLogin:null}),ee=i([]),F=i([]),le=async n=>{S.value[n]=!0,await z("/setting/detil-user",{method:"POST",body:{user_id:n,periode_aktif:w.nama},onResponse({request:e,response:u,options:v}){let m=u._data;S.value[n]=!1,Z.value=`Detil ${m.user.name}`,d.value.userId=m.user.user_id,d.value.nama=m.user.name,d.value.email=m.user.email,d.value.password=m.user.password,d.value.defaultPassword=m.user.default_password,d.value.lastLogin=m.user.login_terakhir,F.value=m.roles,V.value=!0,ee.value=m.permission}})},O=(n,e)=>{let u=n.filter(v=>v.id===e);return u.length?u[0].display_name:"-"},fe=(n,e)=>{let u=n.filter(v=>v.id===e);return u.length?u[0].name:"-"},B=i([]),G=i();i({user_id:null,role:null,periode_aktif:null});const E=i({aksi:null,user_id:null,role:null,periode_aktif:null}),ge=()=>{T.value=!0,E.value={aksi:"reset-password",user_id:d.value.userId,role:null,periode_aktif:null}},ve=(n,e)=>{G.value=`${n}-${e}`,B.value[G.value]=!0,T.value=!0,E.value={aksi:"hapus-akses",user_id:d.value.userId,role:n,periode_aktif:e}},p=i({color:null,title:null,text:null}),ce=[7,8,9],ke=async n=>{n&&await z("/setting/update-user",{method:"POST",body:E.value,onResponse({request:e,response:u,options:v}){let m=u._data;p.value=m,A.value=!0}}),B.value[G.value]=!1},U=i(!1),ye=async()=>{await z("/setting/update-akses",{method:"POST",body:{user_id:d.value.userId,akses:D.value,periode_aktif:w.nama},onResponse({request:n,response:e,options:u}){let v=e._data;p.value.color=v.color,p.value.title=v.title,p.value.text=v.text,U.value=!0}})},be=()=>{V.value=!1,D.value=[],A.value=!1,setTimeout(()=>{p.value={color:"",title:"",text:""}},300),j()},_e=async()=>{await le(d.value.userId)};return(n,e)=>{const u=Ae,v=Te,m=De,Ve=$e,we=Ce,xe=Pe;return c(),P("section",null,[t(K,{class:"mb-6"},{default:s(()=>[t(ae,{class:"pb-4"},{append:s(()=>[t(k,{"prepend-icon":"tabler-file-type-xls",onClick:e[0]||(e[0]=a=>X("unduh")),color:"success"},{default:s(()=>e[17]||(e[17]=[f(" Unduh Pengguna ")])),_:1})]),default:s(()=>[t(te,null,{default:s(()=>e[16]||(e[16]=[f("Akses Pengguna")])),_:1})]),_:1}),t(L),t(x,{class:"d-flex flex-wrap gap-4"},{default:s(()=>[o("div",qe,[t(u,{modelValue:l(r).itemsPerPage,"onUpdate:modelValue":e[1]||(e[1]=a=>l(r).itemsPerPage=a),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}],style:{"inline-size":"6.25rem"}},null,8,["modelValue"])]),t(ie),o("div",he,[o("div",je,[t(v,{modelValue:l(r).searchQuery,"onUpdate:modelValue":e[2]||(e[2]=a=>l(r).searchQuery=a),placeholder:"Cari Data"},null,8,["modelValue"])]),t(u,{modelValue:l(r).selectedRole,"onUpdate:modelValue":e[3]||(e[3]=a=>l(r).selectedRole=a),placeholder:"Filter Hak Akses",items:l(b),clearable:"","clear-icon":"tabler-x",style:{"inline-size":"15rem"},"item-title":"display_name","item-value":"name"},null,8,["modelValue","items"]),t(k,{"prepend-icon":"tabler-bolt",onClick:e[4]||(e[4]=a=>X("new"))},{default:s(()=>e[18]||(e[18]=[f(" Atur Ulang ")])),_:1})])]),_:1}),t(L),t(Ne,{items:l(q),"server-items-length":l(R),headers:de,options:l(r),loading:l(h),"loading-text":"Loading...","onUpdate:sortBy":me},{"item.name":s(({item:a})=>[o("div",He,[t(ze,{size:"34",variant:a.profile_photo_path?void 0:"tonal",color:a.profile_photo_path?void 0:"success"},{default:s(()=>[t(Ie,{src:a.profile_photo_path},null,8,["src"])]),_:2},1032,["variant","color"]),o("div",Qe,[o("h6",Fe,g(a.name),1),o("div",Oe,g(a.email),1)])])]),"item.roles":s(({item:a})=>[f(g(pe(a.roles)),1)]),"item.password":s(({item:a})=>[H(a.password,a.default_password)?(c(),P(I,{key:0},[f(g(a.default_password),1)],64)):(c(),$(re,{key:1,size:"x-small",color:"error"},{default:s(()=>e[19]||(e[19]=[f(" Custom ")])),_:1}))]),"item.actions":s(({item:a})=>[t(k,{loading:l(S)[a.user_id],disabled:l(S)[a.user_id],color:"warning",icon:"tabler-eye",onClick:N=>le(a.user_id)},null,8,["loading","disabled","onClick"])]),bottom:s(()=>[t(m,{page:l(r).page,"onUpdate:page":e[5]||(e[5]=a=>l(r).page=a),"items-per-page":l(r).itemsPerPage,"total-items":l(R)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items","server-items-length","options","loading"])]),_:1}),t(se,{modelValue:l(V),"onUpdate:modelValue":e[8]||(e[8]=a=>C(V)?V.value=a:null),width:"800"},{default:s(()=>[t(Ve,{onClick:e[6]||(e[6]=a=>V.value=!l(V))}),t(K,{style:{position:"relative"}},{default:s(()=>[t(ae,{class:"pb-5"},{default:s(()=>[t(te,null,{default:s(()=>[f(g(l(Z)),1)]),_:1})]),_:1}),t(L),t(ue,{class:"text-no-wrap"},{default:s(()=>[o("tbody",null,[o("tr",null,[e[20]||(e[20]=o("td",null,"Nama",-1)),o("td",null,g(l(d).nama),1)]),o("tr",null,[e[21]||(e[21]=o("td",null,"Email",-1)),o("td",null,g(l(d).email),1)]),o("tr",null,[e[23]||(e[23]=o("td",null,"Password",-1)),o("td",null,[H(l(d).password,l(d).defaultPassword)?(c(),P(I,{key:0},[f(g(l(d).defaultPassword),1)],64)):(c(),$(re,{key:1,size:"x-small",color:"error"},{default:s(()=>e[22]||(e[22]=[f(" Custom ")])),_:1}))])]),o("tr",null,[e[24]||(e[24]=o("td",null,"Terakhir Login",-1)),o("td",null,g(l(d).lastLogin),1)])])]),_:1}),t(x,null,{default:s(()=>e[25]||(e[25]=[o("h4",null,"Hak Akses yang Dimiliki",-1)])),_:1}),t(ue,{class:"text-no-wrap"},{default:s(()=>[e[26]||(e[26]=o("thead",null,[o("tr",null,[o("th",null,"Tahun Pelajaran"),o("th",null,"Hak Akses"),o("th",{class:"text-center"},"Aksi")])],-1)),o("tbody",null,[(c(!0),P(I,null,ne(l(ee),(a,N)=>(c(),P("tr",{key:N},[o("td",null,g(a.name),1),o("td",null,g(O(l(b),a.pivot.role_id)),1),o("td",Ge,[ce.includes(a.pivot.role_id)?(c(),$(k,{key:0,loading:l(B)[`${O(l(b),a.pivot.role_id)}-${a.name}`],disabled:l(B)[`${O(l(b),a.pivot.role_id)}-${a.name}`],color:"error",icon:"tabler-trash",onClick:Ke=>ve(fe(l(b),a.pivot.role_id),a.name)},null,8,["loading","disabled","onClick"])):M("",!0)])]))),128))])]),_:1}),l(F).length?(c(),$(x,{key:0},{default:s(()=>[o("h4",null,"Tambah Hak Akses di Tahun Pelajaran "+g(("$semester"in n?n.$semester:l(w)).nama),1),(c(!0),P(I,null,ne(l(F),a=>(c(),$(Le,{key:a,modelValue:l(D),"onUpdate:modelValue":e[7]||(e[7]=N=>C(D)?D.value=N:null),label:a.text,value:a.value},null,8,["modelValue","label","value"]))),128))]),_:1})):M("",!0),t(L),t(x,{class:"d-flex justify-end flex-wrap gap-3"},{default:s(()=>[H(l(d).password,l(d).defaultPassword)?M("",!0):(c(),$(k,{key:0,color:"error",onClick:ge},{default:s(()=>e[27]||(e[27]=[f(" Reset Password ")])),_:1})),t(ie),t(k,{onClick:ye},{default:s(()=>e[28]||(e[28]=[f(" Simpan ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(we,{isDialogVisible:l(T),"onUpdate:isDialogVisible":e[9]||(e[9]=a=>C(T)?T.value=a:null),isNotifVisible:l(A),"onUpdate:isNotifVisible":e[10]||(e[10]=a=>C(A)?A.value=a:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":"Tindakan ini tidak dapat dikembalikan!","confirm-color":l(p).color,"confirm-title":l(p).title,"confirm-msg":l(p).text,onConfirm:ke,onClose:_e},null,8,["isDialogVisible","isNotifVisible","confirm-color","confirm-title","confirm-msg"]),t(xe,{isDialogVisible:l(U),"onUpdate:isDialogVisible":e[11]||(e[11]=a=>C(U)?U.value=a:null),"confirm-color":l(p).color,"confirm-title":l(p).title,"confirm-msg":l(p).text,onConfirm:be},null,8,["isDialogVisible","confirm-color","confirm-title","confirm-msg"]),t(se,{"max-width":"500",modelValue:l(_),"onUpdate:modelValue":e[15]||(e[15]=a=>C(_)?_.value=a:null)},{default:s(()=>[t(K,{class:"text-center px-10 py-6"},{default:s(()=>[t(x,null,{default:s(()=>[t(k,{icon:"",variant:"outlined",color:"warning",class:"my-4",style:{"block-size":"88px","inline-size":"88px","pointer-events":"none"}},{default:s(()=>e[29]||(e[29]=[o("span",{class:"text-5xl"},"!",-1)])),_:1}),o("h6",Ee,g(l(Q)),1),e[30]||(e[30]=o("p",null,"Silahkan Pilih Jenis Akun",-1))]),_:1}),t(x,{class:"d-flex align-center justify-center gap-2"},{default:s(()=>[t(k,{variant:"elevated",color:"primary",onClick:e[12]||(e[12]=a=>Y("ptk")),loading:l(y),disabled:l(y)},{default:s(()=>e[31]||(e[31]=[f(" Akun PTK ")])),_:1},8,["loading","disabled"]),t(k,{variant:"elevated",color:"error",onClick:e[13]||(e[13]=a=>Y("pd")),loading:l(y),disabled:l(y)},{default:s(()=>e[32]||(e[32]=[f(" Akun PD ")])),_:1},8,["loading","disabled"]),t(k,{color:"secondary",variant:"tonal",onClick:e[14]||(e[14]=a=>_.value=!1),loading:l(y),disabled:l(y)},{default:s(()=>e[33]||(e[33]=[f(" Batal ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{Rl as default};
