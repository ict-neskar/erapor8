import{_ as me}from"./ConfirmDialog-B0Bc_YJ5.js";import{_ as ue}from"./AppTextField-DGISkcON.js";import{_ as de}from"./ProfileSiswa-QBpSSY7_.js";import{_ as pe}from"./AppSelect-D1gjRk4-.js";import{_ as _e}from"./DefaultForm-B0O35sh_.js";import{r as p,f as D,e as o,a as fe,o as g,b as l,t as T,m as a,a2 as k,d as _,aa as W,v as M,y as F,c,am as X,h as z,F as S,ao as ge}from"./main-DOWoIBhU.js";import{$ as E}from"./api-CAM2bx0j.js";import{a as be,d as J}from"./mixins-I8SXeutZ.js";import{V as ve,c as ce,a as ke,b as Y}from"./VCard-DRBiftP4.js";import{V as L}from"./VDivider-DgEwy873.js";import{V as R,a as V}from"./VRow-B3Odvqxs.js";import{V as Ve}from"./VFileInput-BiRxaaBL.js";import{V as ye}from"./VAlert-Ckd596Ug.js";import{V as xe}from"./VTable-C1nYsmx8.js";import{V as je}from"./VForm-BTJ1vPX0.js";import{V as Te}from"./VOverlay-Cnf91z5i.js";import{V as he}from"./VTooltip-DGsh1r8w.js";import"./VDialog-BP5oy-x4.js";import"./forwardRefs-DWGaNmQL.js";import"./VLabel-Hm2kl-Y1.js";import"./VImg-DYyAcwaz.js";import"./VAvatar-B-Z9vLfD.js";import"./VList-DWH4RJSa.js";import"./VMenu-DeAbbdJl.js";import"./VSelectionControl-C8KMTZZ4.js";import"./VChip-Tdr48uqn.js";import"./AppAutocomplete-Cj-BYPX6.js";import"./filter-CR6gUgAk.js";import"./index-BxkgbwWS.js";/* empty css              */const we={key:0,class:"text-center"},Ue={class:"text-center"},$e={style:{"inline-size":"4rem"}},sa={__name:"asesmen-sumatif",setup(De){const B=p(""),q=p(""),s=p({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,teknik_penilaian_id:null,template_excel:null}),u=p({tp:{},sumatif:{}}),y=p({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,teknik_penilaian_id:null,template_excel:null}),d=p({rombel:[],mapel:[],teknik:[],siswa:[],tp:[]}),f=p({rombel:!1,mapel:!1,teknik_penilaian_id:!1,body:!1}),C=p(!1),w=p(!1),A=p(!1),U=p(!1),G=p(""),$=p({color:"",title:"",text:""}),Z=async()=>{w.value=!0;const i={...b,...s.value,...u.value};await E("/penilaian/simpan",{method:"POST",body:i,onResponse({response:e}){let r=e._data;w.value=!1,r.errors?y.value=r.errors:(U.value=!0,$.value=r)}})},b={opsi:"",semester_id:be.semester_id,user_id:J.user_id,guru_id:J.guru_id,sekolah_id:J.sekolah_id,merdeka:!1},P=p(!1),ee=()=>{P.value=!0,s.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,teknik_penilaian_id:null,template_excel:null},u.value={tp:{},sumatif:{}},y.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,teknik_penilaian_id:null,template_excel:null},d.value={rombel:[],mapel:[],teknik:[],siswa:[],tp:[]},f.value={rombel:!1,mapel:!1,teknik_penilaian_id:!1,body:!1},C.value=!1,w.value=!1,A.value=!1,U.value=!1,G.value="",$.value={color:"",title:"",text:""},b.opsi=""},I=async i=>{const e={...i,...b};await E("/referensi/get-data",{method:"POST",body:e,onResponse({response:r}){let m=r._data;i.data=="rombel"&&(d.value.rombel=m),i.data=="mapel"&&(d.value.mapel=m.mapel,b.merdeka=m.merdeka),i.data=="teknik"&&(d.value.teknik=m)}})},ae=async i=>{s.value.rombongan_belajar_id=null,s.value.pembelajaran_id=null,s.value.mata_pelajaran_id=null,i&&(f.value.rombel=!0,await I({data:"rombel",nilai:1,tingkat:i}).then(()=>{f.value.rombel=!1}))},le=async i=>{s.value.pembelajaran_id=null,s.value.mata_pelajaran_id=null,i&&(f.value.mapel=!0,await I({data:"mapel",nilai:1,rombongan_belajar_id:i}).then(()=>{f.value.mapel=!1}))},te=async i=>{s.value.teknik_penilaian_id=null,i&&(f.value.teknik_penilaian_id=!0,await I({data:"teknik"}).then(()=>{f.value.teknik_penilaian_id=!1}))},O=p(!1),N=p(!1),ne=async i=>{d.value.siswa=[],d.value.tp=[],i&&(f.value.body=!0,await E("/penilaian/get-cp",{method:"POST",body:{rombongan_belajar_id:s.value.rombongan_belajar_id,pembelajaran_id:s.value.pembelajaran_id,mata_pelajaran_id:s.value.mata_pelajaran_id,teknik_penilaian_id:s.value.teknik_penilaian_id},onResponse({response:e}){let r=e._data;N.value=r.show_cp,d.value.siswa=r.data_siswa,d.value.tp=r.data_tp,O.value=!1,C.value=!1,r.show_cp&&!r.data_tp.length&&(O.value=!0),d.value.siswa.length&&(C.value=!0),d.value.siswa.forEach(m=>{N.value?(B.value="Sumatif Lingkup Materi",b.opsi="sumatif-lingkup-materi",m.anggota_rombel.nilai_tp.length&&m.anggota_rombel.nilai_tp.forEach(t=>{u.value.tp[m.anggota_rombel.anggota_rombel_id+"#"+t.tp_id]=t.nilai})):(B.value="Sumatif Akhir Semester",b.opsi="sumatif-akhir-semester",m.anggota_rombel.nilai_sumatif.length&&m.anggota_rombel.nilai_sumatif.forEach(t=>{u.value.sumatif[m.anggota_rombel.anggota_rombel_id+"#"+t.jenis]=t.nilai}))}),q.value=`/downloads/template-${b.opsi}/${s.value.pembelajaran_id}`,f.value.body=!1}}))},ie=()=>{ee()},H=i=>{var e=0,r=0;i.forEach(function(t,x){e+=t,r++});var m=e/r;return m.toFixed(0)},K=(i,e)=>{var r=0,m=u.value.sumatif[`${i}#non-tes`],t=u.value.sumatif[`${i}#tes`];m&&t?r=H([parseInt(m),parseInt(t)]):m&&!t?r=m:!m&&t&&(r=t),u.value.sumatif[`${i}#na`]=r},h=p(!1),oe=async i=>{h.value=!0;const e=new FormData;e.append("template_excel",i),e.append("rombongan_belajar_id",s.value.rombongan_belajar_id),e.append("pembelajaran_id",s.value.pembelajaran_id),e.append("sekolah_id",s.value.sekolah_id),e.append("merdeka",b.merdeka),e.append("opsi",b.opsi),await E("/penilaian/upload-nilai",{method:"POST",body:e,onResponse({response:r}){let m=r._data;h.value=!1,s.value.template_excel=null,m.data_nilai.forEach(t=>{if(b.opsi=="sumatif-lingkup-materi")t.nilai.forEach(j=>{u.value.tp[t.anggota_rombel_id+"#"+j.tp]=j.angka});else{u.value.sumatif[t.anggota_rombel_id+"#non-tes"]=t.nilai_non_tes,u.value.sumatif[t.anggota_rombel_id+"#tes"]=t.nilai_tes;var x=0;t.nilai_non_tes&&t.nilai_tes?x=H([t.nilai_non_tes,t.nilai_tes]):t.nilai_non_tes&&!t.nilai_tes?x=t.nilai_non_tes:!t.nilai_non_tes&&t.nilai_tes&&(x=t.nilai_tes),u.value.sumatif[t.anggota_rombel_id+"#na"]=x}})}})};return(i,e)=>{const r=_e,m=pe,t=fe("router-link"),x=de,j=ue,se=me;return g(),D(ve,{class:"mb-6"},{default:o(()=>[l(ke,{class:"pb-4"},{default:o(()=>[l(ce,null,{default:o(()=>e[10]||(e[10]=[T("Input Asesmen")])),_:1})]),_:1}),l(L),l(je,{onSubmit:ge(Z,["prevent"])},{default:o(()=>[l(Y,null,{default:o(()=>[l(R,null,{default:o(()=>[l(r,{form:a(s),"onUpdate:form":e[0]||(e[0]=n=>k(s)?s.value=n:null),errors:a(y),"onUpdate:errors":e[1]||(e[1]=n=>k(y)?y.value=n:null),arrayData:a(d),"onUpdate:arrayData":e[2]||(e[2]=n=>k(d)?d.value=n:null),loading:a(f),"onUpdate:loading":e[3]||(e[3]=n=>k(f)?f.value=n:null),resetForm:a(P),"onUpdate:resetForm":e[4]||(e[4]=n=>k(P)?P.value=n:null),onTingkat:ae,onRombongan_belajar_id:le,onPembelajaran_id:te},null,8,["form","errors","arrayData","loading","resetForm"]),l(V,{cols:"12"},{default:o(()=>[l(R,{"no-gutters":""},{default:o(()=>[l(V,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:o(()=>e[11]||(e[11]=[_("label",{class:"v-label text-body-2 text-high-emphasis",for:"teknik_penilaian_id"},"Jenis Asesmen",-1)])),_:1}),l(V,{cols:"12",md:"9"},{default:o(()=>[l(m,{modelValue:a(s).teknik_penilaian_id,"onUpdate:modelValue":[e[5]||(e[5]=n=>a(s).teknik_penilaian_id=n),ne],placeholder:"== Pilih Jenis Asesmen ==",items:a(d).teknik,clearable:"","clear-icon":"tabler-x","item-value":"teknik_penilaian_id","item-title":"nama","error-messages":a(y).teknik_penilaian_id,loading:a(f).teknik_penilaian_id,disabled:a(f).teknik_penilaian_id},null,8,["modelValue","items","error-messages","loading","disabled"])]),_:1})]),_:1})]),_:1}),a(d).siswa.length?(g(),D(V,{key:0,cols:"12"},{default:o(()=>[l(R,{"no-gutters":""},{default:o(()=>[l(V,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:o(()=>e[12]||(e[12]=[_("label",{class:"v-label text-body-2 text-high-emphasis",for:"template_excel"},"Template Excel",-1)])),_:1}),l(V,{cols:"12",md:"9"},{default:o(()=>[l(R,{"no-gutters":""},{default:o(()=>[l(V,{cols:"6"},{default:o(()=>[l(Ve,{id:"template_excel",modelValue:a(s).template_excel,"onUpdate:modelValue":[e[6]||(e[6]=n=>a(s).template_excel=n),oe],"error-messages":a(y).template_excel,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",label:"Unggah Template Excel"},null,8,["modelValue","error-messages"])]),_:1}),l(V,{cols:"6"},{default:o(()=>[l(W,{color:"primary",class:"ms-3",href:a(q),target:"_blank"},{default:o(()=>[T(" Unduh Template "+M(a(B)),1)]),_:1},8,["href"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),a(f).body?(g(),c("div",we,[l(X,{size:60,indeterminate:"",color:"error",class:"my-10"})])):F("",!0),a(O)?(g(),D(ye,{key:1,color:"error",class:"text-center my-4",variant:"tonal"},{default:o(()=>[e[15]||(e[15]=_("h2",{class:"mt-4 mb-4"},"Tidak ditemukan data Tujuan Pembelajaran",-1)),_("p",null,[e[14]||(e[14]=T(" Silahkan tambah data Tujuan Pembelajaran terlebih dahulu ")),l(t,{to:{name:"referensi-tujuan-pembelajaran"}},{default:o(()=>e[13]||(e[13]=[T("disini")])),_:1})])]),_:1})):F("",!0)]),_:1}),l(L),a(d).siswa.length&&!a(h)?(g(),D(xe,{key:0,class:"text-no-wrap"},{default:o(()=>[_("thead",null,[_("tr",null,[e[19]||(e[19]=_("th",{class:"text-center"},"Nama Peserta Didik",-1)),a(N)?(g(!0),c(S,{key:0},z(a(d).tp,(n,Q)=>(g(),c("th",Ue,[T(M(`TP ${Q+1}`)+" ",1),l(he,{location:"top",activator:"parent",transition:"scale-transition"},{default:o(()=>[T(M(n.deskripsi),1)]),_:2},1024)]))),256)):(g(),c(S,{key:1},[e[16]||(e[16]=_("th",{class:"text-center"},"Non Tes",-1)),e[17]||(e[17]=_("th",{class:"text-center"},"Tes",-1)),e[18]||(e[18]=_("th",{class:"text-center"},"NA Sumatif Akhir Semester",-1))],64))])]),_("tbody",null,[(g(!0),c(S,null,z(a(d).siswa,(n,Q)=>(g(),c("tr",null,[_("td",null,[l(x,{item:n},null,8,["item"])]),a(N)?(g(!0),c(S,{key:0},z(a(d).tp,(v,Fe)=>(g(),c("td",null,[_("div",$e,[l(j,{type:"number",modelValue:a(u).tp[n.anggota_rombel.anggota_rombel_id+"#"+v.tp_id],"onUpdate:modelValue":re=>a(u).tp[n.anggota_rombel.anggota_rombel_id+"#"+v.tp_id]=re},null,8,["modelValue","onUpdate:modelValue"])])]))),256)):(g(),c(S,{key:1},[_("td",null,[l(j,{type:"number",modelValue:a(u).sumatif[n.anggota_rombel.anggota_rombel_id+"#non-tes"],"onUpdate:modelValue":[v=>a(u).sumatif[n.anggota_rombel.anggota_rombel_id+"#non-tes"]=v,v=>K(n.anggota_rombel.anggota_rombel_id,"#non-tes")]},null,8,["modelValue","onUpdate:modelValue"])]),_("td",null,[l(j,{type:"number",modelValue:a(u).sumatif[n.anggota_rombel.anggota_rombel_id+"#tes"],"onUpdate:modelValue":[v=>a(u).sumatif[n.anggota_rombel.anggota_rombel_id+"#tes"]=v,v=>K(n.anggota_rombel.anggota_rombel_id,"#tes")]},null,8,["modelValue","onUpdate:modelValue"])]),_("td",null,[l(j,{type:"number",modelValue:a(u).sumatif[n.anggota_rombel.anggota_rombel_id+"#na"],"onUpdate:modelValue":v=>a(u).sumatif[n.anggota_rombel.anggota_rombel_id+"#na"]=v,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])],64))]))),256))])]),_:1})):F("",!0),l(L),a(C)?(g(),D(Y,{key:1,class:"d-flex justify-end flex-wrap gap-3 pt-5 overflow-visible"},{default:o(()=>[l(W,{variant:"elevated",type:"submit",loading:a(w),disabled:a(w)},{default:o(()=>e[20]||(e[20]=[T(" Simpan ")])),_:1},8,["loading","disabled"])]),_:1})):F("",!0)]),_:1}),l(se,{isDialogVisible:a(A),"onUpdate:isDialogVisible":e[7]||(e[7]=n=>k(A)?A.value=n:null),isNotifVisible:a(U),"onUpdate:isNotifVisible":e[8]||(e[8]=n=>k(U)?U.value=n:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":a(G),"confirm-color":a($).color,"confirm-title":a($).title,"confirm-msg":a($).text,onClose:ie},null,8,["isDialogVisible","isNotifVisible","confirmation-text","confirm-color","confirm-title","confirm-msg"]),l(Te,{modelValue:a(h),"onUpdate:modelValue":e[9]||(e[9]=n=>k(h)?h.value=n:null),contained:"",persistent:"","scroll-strategy":"none",class:"align-center justify-center"},{default:o(()=>[l(X,{indeterminate:""})]),_:1},8,["modelValue"])]),_:1})}}};export{sa as default};
